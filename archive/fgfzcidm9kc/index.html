<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="$(function(){ var html = &#34;\n\x3ch2 id=\x22articleHeader0\x22\x3e\x26#x524D;\x26#x8A00;\x3c\/h2\x3e\x3cp\x3e\x26#x3000;\x26#x3000;\x26#x9996;\x26#x5148;\x26#x6B22;\x26#x8FCE;\x26#x5927;\x26#x5BB6;\x26#"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Vue响应式数据: Observer模块实现"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="$(function(){ var html = &#34;\n\x3ch2 id=\x22articleHeader0\x22\x3e\x26#x524D;\x26#x8A00;\x3c\/h2\x3e\x3cp\x3e\x26#x3000;\x26#x3000;\x26#x9996;\x26#x5148;\x26#x6B22;\x26#x8FCE;\x26#x5927;\x26#x5BB6;\x26#"><meta property="og:site_name" content="Alili"><title>Vue响应式数据: Observer模块实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad()</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error",function(e){var t=e.target;"img"==t.tagName.toLowerCase()&&(t.style.display="none")},!0)</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/fgfzcidm9kc/",
				"appid": "1613049289050283", 
				"title": "Vue响应式数据: Observer模块实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2018-11-25T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/kk83myrfjea/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" href="https://alili.tech/archive/03er0mag15sn/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f&text=Vue%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%3a%20Observer%e6%a8%a1%e5%9d%97%e5%ae%9e%e7%8e%b0"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f&text=Vue%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%3a%20Observer%e6%a8%a1%e5%9d%97%e5%ae%9e%e7%8e%b0"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f&title=Vue%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%3a%20Observer%e6%a8%a1%e5%9d%97%e5%ae%9e%e7%8e%b0"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f&is_video=false&description=Vue%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%3a%20Observer%e6%a8%a1%e5%9d%97%e5%ae%9e%e7%8e%b0"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Vue%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%3a%20Observer%e6%a8%a1%e5%9d%97%e5%ae%9e%e7%8e%b0&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f&title=Vue%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%3a%20Observer%e6%a8%a1%e5%9d%97%e5%ae%9e%e7%8e%b0"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f&title=Vue%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%3a%20Observer%e6%a8%a1%e5%9d%97%e5%ae%9e%e7%8e%b0"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f&title=Vue%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%3a%20Observer%e6%a8%a1%e5%9d%97%e5%ae%9e%e7%8e%b0"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffgfzcidm9kc%2f&title=Vue%e5%93%8d%e5%ba%94%e5%bc%8f%e6%95%b0%e6%8d%ae%3a%20Observer%e6%a8%a1%e5%9d%97%e5%ae%9e%e7%8e%b0"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Vue响应式数据: Observer模块实现</h1><div class="meta"><div class="postdate"><time datetime="2018-11-25" itemprop="datePublished">2018-11-25</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><script>$(function(){var x='\n<h2 id="articleHeader0">&#x524D;&#x8A00;</h2><p>&#x3000;&#x3000;&#x9996;&#x5148;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x5173;&#x6CE8;&#x6211;&#x7684;<a href="https://github.com/MrErHu/blog" rel="nofollow noreferrer" target="_blank">Github&#x535A;&#x5BA2;</a>&#xFF0C;&#x4E5F;&#x7B97;&#x662F;&#x5BF9;&#x6211;&#x7684;&#x4E00;&#x70B9;&#x9F13;&#x52B1;&#xFF0C;&#x6BD5;&#x7ADF;&#x5199;&#x4E1C;&#x897F;&#x6CA1;&#x6CD5;&#x83B7;&#x5F97;&#x53D8;&#x73B0;&#xFF0C;&#x80FD;&#x575A;&#x6301;&#x4E0B;&#x53BB;&#x4E5F;&#x662F;&#x9760;&#x7684;&#x662F;&#x81EA;&#x5DF1;&#x7684;&#x70ED;&#x60C5;&#x548C;&#x5927;&#x5BB6;&#x7684;&#x9F13;&#x52B1;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x65E5;&#x5B50;&#x6211;&#x5E94;&#x8BE5;&#x4F1A;&#x7740;&#x529B;&#x5199;&#x4E00;&#x7CFB;&#x5217;&#x5173;&#x4E8E;Vue&#x4E0E;React&#x5185;&#x90E8;&#x539F;&#x7406;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x540C;&#x5B66;&#x70B9;&#x4E2A;&#x5173;&#x6CE8;&#x6216;&#x8005;Star&#x3002;<br>&#x3000;&#x3000;&#x4E4B;&#x524D;&#x7684;&#x4E24;&#x7BC7;&#x6587;&#x7AE0;<a href="https://github.com/MrErHu/blog/issues/28" rel="nofollow noreferrer" target="_blank">&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x4E0E;&#x6570;&#x636E;&#x4F9D;&#x8D56;&#x57FA;&#x672C;&#x539F;&#x7406;</a>&#x548C;<a href="https://github.com/MrErHu/blog/issues/29" rel="nofollow noreferrer" target="_blank">&#x4ECE;Vue&#x6570;&#x7EC4;&#x54CD;&#x5E94;&#x5316;&#x6240;&#x5F15;&#x53D1;&#x7684;&#x601D;&#x8003;</a>&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;&#x4E86;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x6CA1;&#x6709;&#x770B;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x4E0A;&#x9762;&#x7684;&#x94FE;&#x63A5;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x3002;&#x5982;&#x679C;&#x5927;&#x5BB6;&#x90FD;&#x9605;&#x8BFB;&#x8FC7;&#x4E0A;&#x9762;&#x4E24;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x8BDD;&#xFF0C;&#x80AF;&#x5B9A;&#x5BF9;&#x8FD9;&#x65B9;&#x9762;&#x5185;&#x5BB9;&#x6709;&#x4E86;&#x8DB3;&#x591F;&#x7684;&#x77E5;&#x8BC6;&#x50A8;&#x5907;&#xFF0C;&#x60F3;&#x6765;&#x662F;&#x65F6;&#x5019;&#x6765;&#x770B;&#x770B;Vue&#x5185;&#x90E8;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x54CD;&#x5E94;&#x5316;&#x3002;&#x76EE;&#x524D;Vue&#x7684;&#x4EE3;&#x7801;&#x975E;&#x5E38;&#x5E9E;&#x5927;&#xFF0C;&#x4F46;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4F8B;&#x5982;&#xFF1A;&#x670D;&#x52A1;&#x5668;&#x6E32;&#x67D3;&#x7B49;&#x6211;&#x4EEC;&#x4E0D;&#x5173;&#x5FC3;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4E3A;&#x4E86;&#x80FD;&#x96C6;&#x4E2D;&#x4E8E;&#x6211;&#x4EEC;&#x60F3;&#x5B66;&#x4E60;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x6B21;&#x9605;&#x8BFB;&#x7684;&#x662F;Vue&#x7684;&#x65E9;&#x671F;&#x4EE3;&#x7801;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;<code>checkout</code>&#x5230;<a href="https://github.com/vuejs/vue/tree/4e062e9270c90d6c4e4105bb08f5a1bc61270e2e" rel="nofollow noreferrer" target="_blank">&#x8FD9;&#x91CC;</a>&#x67E5;&#x770B;&#x5BF9;&#x5E94;&#x7684;&#x4EE3;&#x7801;&#x3002;<br>&#x3000;&#x3000;&#x4E4B;&#x524D;&#x96F6;&#x96F6;&#x788E;&#x788E;&#x7684;&#x770B;&#x8FC7;React&#x7684;&#x90E8;&#x5206;&#x6E90;&#x7801;&#xFF0C;&#x5F53;&#x6211;&#x770B;&#x5230;Vue&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x89C9;&#x5F97;&#x771F;&#x7684;&#x662F;&#x975E;&#x5E38;&#x4F18;&#x79C0;&#xFF0C;&#x5404;&#x4E2A;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x89E3;&#x8026;&#x7684;&#x975E;&#x5E38;&#x597D;&#xFF0C;&#x53EF;&#x8BFB;&#x6027;&#x4E5F;&#x5F88;&#x9AD8;&#x3002;Vue&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x662F;&#x5728;<code>Observer</code>&#x6A21;&#x5757;&#x4E2D;&#x5B9E;&#x73B0;&#x7684;,&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x770B;<code>Observer</code>&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;&#x3002;<br>&#x3000;&#x3000;</p><h2 id="articleHeader1">&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6A21;&#x5F0F;&#x3000;&#x3000;</h2><p>&#x3000;&#x3000;&#x5982;&#x679C;&#x770B;&#x8FC7;&#x4E0A;&#x4E24;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x540C;&#x5B66;&#x5E94;&#x8BE5;&#x4F1A;&#x53D1;&#x73B0;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x6570;&#x636E;&#x54CD;&#x5E94;&#x5316;&#x7684;&#x4EE3;&#x7801;&#x4E0E;&#x5176;&#x4ED6;&#x7684;&#x4EE3;&#x7801;&#x8026;&#x5408;&#x592A;&#x5F3A;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;:<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//&#x4EE3;&#x7801;&#x6765;&#x6E90;&#x4E8E;&#x6587;&#x7AE0;&#xFF1A;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x4E0E;&#x6570;&#x636E;&#x4F9D;&#x8D56;&#x57FA;&#x672C;&#x539F;&#x7406;\n//&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7684;&#x5355;&#x4E2A;&#x54CD;&#x5E94;&#x5F0F;&#x5C5E;&#x6027;\nfunction defineReactive(obj, key, value){\n  observify(value);\n  Object.defineProperty(obj, key, {\n    configurable: true,\n    enumerable: true,\n    set: function(newValue){\n      var oldValue = value;\n      value = newValue;\n      //&#x53EF;&#x4EE5;&#x5728;&#x4FEE;&#x6539;&#x6570;&#x636E;&#x65F6;&#x89E6;&#x53D1;&#x5176;&#x4ED6;&#x7684;&#x64CD;&#x4F5C;\n      console.log(&quot;newValue: &quot;, newValue, &quot; oldValue: &quot;, oldValue);\n    },\n    get: function(){\n      return value;\n    }\n  });\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">//&#x4EE3;&#x7801;&#x6765;&#x6E90;&#x4E8E;&#x6587;&#x7AE0;&#xFF1A;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x4E0E;&#x6570;&#x636E;&#x4F9D;&#x8D56;&#x57FA;&#x672C;&#x539F;&#x7406;</span>\n<span class="hljs-comment">//&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7684;&#x5355;&#x4E2A;&#x54CD;&#x5E94;&#x5F0F;&#x5C5E;&#x6027;</span>\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defineReactive</span>(<span class="hljs-params">obj, key, value</span>)</span>{\n  observify(value);\n  <span class="hljs-built_in">Object</span>.defineProperty(obj, key, {\n    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">newValue</span>)</span>{\n      <span class="hljs-keyword">var</span> oldValue = value;\n      value = newValue;\n      <span class="hljs-comment">//&#x53EF;&#x4EE5;&#x5728;&#x4FEE;&#x6539;&#x6570;&#x636E;&#x65F6;&#x89E6;&#x53D1;&#x5176;&#x4ED6;&#x7684;&#x64CD;&#x4F5C;</span>\n      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;newValue: &quot;</span>, newValue, <span class="hljs-string">&quot; oldValue: &quot;</span>, oldValue);\n    },\n    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{\n      <span class="hljs-keyword">return</span> value;\n    }\n  });\n}</code></pre><p>&#x3000;&#x3000;&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF0C;<code>set</code>&#x5185;&#x90E8;&#x7684;&#x5904;&#x7406;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x4E0E;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x54CD;&#x5E94;&#x5316;&#x76F8;&#x8026;&#x5408;&#xFF0C;&#x5982;&#x679C;&#x4E0B;&#x6B21;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5728;<code>set</code>&#x4E2D;&#x505A;&#x5176;&#x4ED6;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x8981;&#x4FEE;&#x6539;<code>set</code>&#x51FD;&#x6570;&#x5185;&#x90E8;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x4E0D;&#x53CB;&#x597D;&#x7684;&#xFF0C;&#x4E0D;&#x7B26;&#x5408;&#x5F00;&#x95ED;&#x539F;&#x5219;(OCP: Open Close Principle)&#x3002;&#x5F53;&#x7136;Vue&#x4E0D;&#x4F1A;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x53BB;&#x8BBE;&#x8BA1;&#xFF0C;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;Vue&#x5F15;&#x5165;&#x4E86;<strong>&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6A21;&#x5F0F;</strong>&#x3002;&#x5176;&#x5B9E;&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6A21;&#x5F0F;&#x662F;&#x524D;&#x7AEF;&#x5DE5;&#x7A0B;&#x5E08;&#x975E;&#x5E38;&#x719F;&#x6089;&#x7684;&#x4E00;&#x79CD;&#x6A21;&#x5F0F;&#xFF0C;&#x53C8;&#x53EB;&#x505A;<strong>&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;</strong>&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x79CD;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x95F4;&#x4E00;&#x79CD;<strong>&#x4E00;&#x5BF9;&#x591A;</strong>&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x4ED6;&#x89C2;&#x5BDF;&#x5B83;&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x4F1A;&#x5F97;&#x5230;&#x901A;&#x77E5;&#x3002;&#x6211;&#x4EEC;&#x6700;&#x5E38;&#x89C1;&#x7684;DOM&#x4E8B;&#x4EF6;&#x5C31;&#x662F;&#x4E00;&#x79CD;<strong>&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6A21;&#x5F0F;</strong>&#x3002;&#x6BD4;&#x5982;&#xFF1A;<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="document.body.addEventListener(&quot;click&quot;, function(){\n    console.log(&quot;click event&quot;);\n});" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{\n    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;click event&quot;</span>);\n});</code></pre><p>&#x3000;&#x3000;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x76D1;&#x542C;&#x4E86;<code>body</code>&#x7684;<code>click</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x4E0D;&#x77E5;&#x9053;<code>click</code>&#x4E8B;&#x4EF6;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F1A;&#x53D1;&#x751F;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4E00;&#x5B9A;&#x80FD;&#x4FDD;&#x8BC1;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x751F;&#x4E86;<code>body</code>&#x7684;<code>click</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x5B9A;&#x80FD;&#x5F97;&#x5230;&#x901A;&#x77E5;&#xFF0C;&#x5373;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x5728;JavaScript&#x4E2D;&#x56E0;&#x4E3A;&#x51FD;&#x6570;&#x662F;&#x4E00;&#x7B49;&#x516C;&#x6C11;&#xFF0C;&#x6211;&#x4EEC;&#x5F88;&#x5C11;&#x4F7F;&#x7528;&#x4F20;&#x7EDF;&#x7684;&#x53D1;&#x5E03;-&#x8BA2;&#x9605;&#x6A21;&#x5F0F;&#xFF0C;&#x591A;&#x91C7;&#x7528;&#x7684;&#x662F;<strong>&#x4E8B;&#x4EF6;&#x6A21;&#x578B;</strong>&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x3002;&#x5728;Vue&#x4E2D;&#x4E5F;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x6A21;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x3002;&#x56E0;&#x4E3A;Vue&#x7684;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x89E3;&#x8026;&#x7684;&#x975E;&#x5E38;&#x597D;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x770B;&#x4EE3;&#x7801;&#x4E4B;&#x524D;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x6765;&#x770B;&#x770B;&#x5BF9;&#x5E94;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;&#xFF0C;&#x4F60;&#x5C31;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x6A21;&#x5757;&#x8981;&#x5B9E;&#x73B0;&#x4EC0;&#x4E48;&#x529F;&#x80FD;&#xFF0C;&#x751A;&#x81F3;&#x5982;&#x679C;&#x4F60;&#x613F;&#x610F;&#x7684;&#x8BDD;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x7684;&#x6A21;&#x5757;&#x653E;&#x8FDB;Vue&#x7684;&#x6E90;&#x7801;&#x4E2D;&#x8FD0;&#x884C;&#x3002;</p><p>&#x3000;&#x3000;Vue&#x65E9;&#x671F;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x662F;<code>jasmine</code>&#x8FDB;&#x884C;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;<code>emitter_spec.js</code>&#x662F;&#x4E8B;&#x4EF6;&#x6A21;&#x578B;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;&#x3002;&#x9996;&#x5148;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;<code>jasmine</code>&#x7528;&#x5230;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x7167;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E86;&#x89E3;&#x5177;&#x4F53;&#x7684;&#x529F;&#x80FD;&#xFF1A;</p><ul><li><code>describe</code>&#x662F;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x5355;&#x5143;&#x96C6;&#x5408;</li><li><code>it</code>&#x662F;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;</li><li><code>beforeEach</code>&#x4F1A;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;<code>it</code>&#x6267;&#x884C;&#x524D;&#x6267;&#x884C;</li><li><code>expect</code>&#x671F;&#x671B;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4F5C;&#x5BF9;&#x671F;&#x671B;&#x503C;&#x548C;&#x5B9E;&#x9645;&#x503C;&#x4E4B;&#x95F4;&#x6267;&#x884C;&#x903B;&#x8F91;&#x6BD4;&#x8F83;</li><li><code>createSpy</code>&#x7528;&#x6765;&#x521B;&#x5EFA;spy,&#x800C;spy&#x7684;&#x4F5C;&#x7528;&#x662F;&#x76D1;&#x6D4B;&#x51FD;&#x6570;&#x7684;<strong>&#x8C03;&#x7528;</strong>&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x548C;<strong>&#x51FD;&#x6570;&#x6267;&#x884C;&#x53C2;&#x6570;</strong></li></ul><p>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="var Emitter = require(&apos;../../../src/emitter&apos;)\nvar u = undefined\n// &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;\ndescribe(&apos;Emitter&apos;, function () {\n\n  var e, spy\n  beforeEach(function () {\n    e = new Emitter()\n    spy = jasmine.createSpy(&apos;emitter&apos;)\n  })\n  \n  it(&apos;on&apos;, function () {\n    e.on(&apos;test&apos;, spy)\n    e.emit(&apos;test&apos;, 1, 2 ,3)\n    expect(spy.calls.count()).toBe(1)\n    expect(spy).toHaveBeenCalledWith(1, 2, 3)\n  })\n\n  it(&apos;once&apos;, function () {\n    e.once(&apos;test&apos;, spy)\n    e.emit(&apos;test&apos;, 1, 2 ,3)\n    e.emit(&apos;test&apos;, 2, 3, 4)\n    expect(spy.calls.count()).toBe(1)\n    expect(spy).toHaveBeenCalledWith(1, 2, 3)\n  })\n\n  it(&apos;off&apos;, function () {\n    e.on(&apos;test1&apos;, spy)\n    e.on(&apos;test2&apos;, spy)\n    e.off()\n    e.emit(&apos;test1&apos;)\n    e.emit(&apos;test2&apos;)\n    expect(spy.calls.count()).toBe(0)\n  })\n  \n  it(&apos;apply emit&apos;, function () {\n    e.on(&apos;test&apos;, spy)\n    e.applyEmit(&apos;test&apos;, 1)\n    e.applyEmit(&apos;test&apos;, 1, 2, 3, 4, 5)\n    expect(spy).toHaveBeenCalledWith(1)\n    expect(spy).toHaveBeenCalledWith(1, 2, 3, 4, 5)\n  })\n\n})" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-keyword">var</span> Emitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;../../../src/emitter&apos;</span>)\n<span class="hljs-keyword">var</span> u = <span class="hljs-literal">undefined</span>\n<span class="hljs-comment">// &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;</span>\ndescribe(<span class="hljs-string">&apos;Emitter&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n\n  <span class="hljs-keyword">var</span> e, spy\n  beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    e = <span class="hljs-keyword">new</span> Emitter()\n    spy = jasmine.createSpy(<span class="hljs-string">&apos;emitter&apos;</span>)\n  })\n  \n  it(<span class="hljs-string">&apos;on&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    e.on(<span class="hljs-string">&apos;test&apos;</span>, spy)\n    e.emit(<span class="hljs-string">&apos;test&apos;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span> ,<span class="hljs-number">3</span>)\n    expect(spy.calls.count()).toBe(<span class="hljs-number">1</span>)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)\n  })\n\n  it(<span class="hljs-string">&apos;once&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    e.once(<span class="hljs-string">&apos;test&apos;</span>, spy)\n    e.emit(<span class="hljs-string">&apos;test&apos;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span> ,<span class="hljs-number">3</span>)\n    e.emit(<span class="hljs-string">&apos;test&apos;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)\n    expect(spy.calls.count()).toBe(<span class="hljs-number">1</span>)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)\n  })\n\n  it(<span class="hljs-string">&apos;off&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    e.on(<span class="hljs-string">&apos;test1&apos;</span>, spy)\n    e.on(<span class="hljs-string">&apos;test2&apos;</span>, spy)\n    e.off()\n    e.emit(<span class="hljs-string">&apos;test1&apos;</span>)\n    e.emit(<span class="hljs-string">&apos;test2&apos;</span>)\n    expect(spy.calls.count()).toBe(<span class="hljs-number">0</span>)\n  })\n  \n  it(<span class="hljs-string">&apos;apply emit&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    e.on(<span class="hljs-string">&apos;test&apos;</span>, spy)\n    e.applyEmit(<span class="hljs-string">&apos;test&apos;</span>, <span class="hljs-number">1</span>)\n    e.applyEmit(<span class="hljs-string">&apos;test&apos;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-number">1</span>)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)\n  })\n\n})</code></pre><p>&#x3000;&#x3000;&#x53EF;&#x4EE5;&#x770B;&#x51FA;<code>Emitter</code>&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x4EE5;&#x4E0B;&#x63A5;&#x53E3;&#xFF1A;</p><ul><li><code>on</code>: &#x6CE8;&#x518C;&#x76D1;&#x542C;&#x63A5;&#x53E3;&#xFF0C;&#x53C2;&#x6570;&#x5206;&#x522B;&#x662F;<strong>&#x4E8B;&#x4EF6;&#x540D;</strong>&#x548C;<strong>&#x76D1;&#x542C;&#x51FD;&#x6570;</strong></li><li><code>emit</code>: &#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x51FD;&#x6570;&#xFF0C;&#x53C2;&#x6570;&#x662F;<strong>&#x4E8B;&#x4EF6;&#x540D;</strong></li><li><code>off</code>: &#x53D6;&#x6D88;&#x5BF9;&#x5E94;&#x4E8B;&#x4EF6;&#x7684;&#x6CE8;&#x518C;&#x51FD;&#x6570;&#xFF0C;&#x53C2;&#x6570;&#x5206;&#x522B;&#x662F;<strong>&#x4E8B;&#x4EF6;&#x540D;</strong>&#x548C;<strong>&#x76D1;&#x542C;&#x51FD;&#x6570;</strong></li><li><code>once</code>: &#x4E0E;<code>on</code>&#x7C7B;&#x4F3C;&#xFF0C;&#x4EC5;&#x4F1A;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x65F6;&#x901A;&#x77E5;&#x76D1;&#x542C;&#x51FD;&#x6570;&#xFF0C;&#x968F;&#x540E;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x4F1A;&#x88AB;&#x79FB;&#x9664;&#x3002;</li></ul><p>&#x3000;&#x3000;&#x770B;&#x5B8C;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x57FA;&#x672C;&#x4E86;&#x89E3;&#x4E86;&#x8FD9;&#x4E2A;&#x6A21;&#x5757;&#x8981;&#x5E72;&#x4EC0;&#x4E48;&#xFF0C;&#x73B0;&#x5728;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x5BF9;&#x5E94;&#x7684;&#x4EE3;&#x7801;:</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// &#x5220;&#x53BB;&#x4E86;&#x6CE8;&#x91CA;&#x5E76;&#x4E14;&#x5BF9;&#x4EE3;&#x7801;&#x987A;&#x5E8F;&#x6709;&#x8C03;&#x6574;\n// ctx&#x662F;&#x76D1;&#x542C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x4F5C;&#x7528;&#x57DF;(this)\nfunction Emitter (ctx) {\n  this._ctx = ctx || this\n}\n\nvar p = Emitter.prototype\n\np.on = function (event, fn) {\n  this._cbs = this._cbs || {}\n  ;(this._cbs[event] || (this._cbs[event] = []))\n    .push(fn)\n  return this\n}\n// &#x4E09;&#x79CD;&#x6A21;&#x5F0F; \n// &#x4E0D;&#x4F20;&#x53C2;&#x60C5;&#x51B5;&#x6E05;&#x7A7A;&#x6240;&#x6709;&#x76D1;&#x542C;&#x51FD;&#x6570; \n// &#x4EC5;&#x4F20;&#x4E8B;&#x4EF6;&#x540D;&#x5219;&#x6E05;&#x9664;&#x8BE5;&#x4E8B;&#x4EF6;&#x7684;&#x6240;&#x6709;&#x76D1;&#x542C;&#x51FD;&#x6570;\n// &#x4F20;&#x9012;&#x4E8B;&#x4EF6;&#x540D;&#x548C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x5219;&#x5BF9;&#x5E94;&#x4EC5;&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;\np.off = function (event, fn) {\n  this._cbs = this._cbs || {}\n\n  // all\n  if (!arguments.length) {\n    this._cbs = {}\n    return this\n  }\n\n  // specific event\n  var callbacks = this._cbs[event]\n  if (!callbacks) return this\n\n  // remove all handlers\n  if (arguments.length === 1) {\n    delete this._cbs[event]\n    return this\n  }\n\n  // remove specific handler\n  var cb\n  for (var i = 0; i &lt; callbacks.length; i++) {\n    cb = callbacks[i]\n    // &#x8FD9;&#x8FB9;&#x7684;&#x4EE3;&#x7801;&#x4E4B;&#x6240;&#x4EE5;&#x4F1A;&#x6709;cb.fn === fn&#x8981;&#x7ED3;&#x5408;once&#x51FD;&#x6570;&#x53BB;&#x770B;\n    // &#x7ED9;once&#x4F20;&#x9012;&#x7684;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x5176;&#x5B9E;&#x5DF2;&#x7ECF;&#x88AB;wrapped&#x8FC7;\n    // &#x4F46;&#x662F;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x539F;&#x6765;&#x7684;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x53BB;off&#x6389;\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1)\n      break\n    }\n  }\n  return this\n}\n// &#x89E6;&#x53D1;&#x5BF9;&#x5E94;&#x4E8B;&#x4EF6;&#x7684;&#x6240;&#x6709;&#x76D1;&#x542C;&#x51FD;&#x6570;&#xFF0C;&#x6CE8;&#x610F;&#x6700;&#x591A;&#x53EA;&#x80FD;&#x7528;&#x7ED9;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x4F20;&#x9012;&#x4E09;&#x4E2A;&#x53C2;&#x6570;(&#x91C7;&#x7528;call)\np.emit = function (event, a, b, c) {\n  this._cbs = this._cbs || {}\n  var callbacks = this._cbs[event]\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0)\n    for (var i = 0, len = callbacks.length; i &lt; len; i++) {\n      callbacks[i].call(this._ctx, a, b, c)\n    }\n  }\n\n  return this\n}\n// &#x89E6;&#x53D1;&#x5BF9;&#x5E94;&#x4E8B;&#x4EF6;&#x7684;&#x6240;&#x6709;&#x76D1;&#x542C;&#x51FD;&#x6570;&#xFF0C;&#x4F20;&#x9012;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x4E0D;&#x53D7;&#x9650;&#x5236;(&#x91C7;&#x7528;apply)\np.applyEmit = function (event) {\n  this._cbs = this._cbs || {}\n  var callbacks = this._cbs[event], args\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0)\n    args = callbacks.slice.call(arguments, 1)\n    for (var i = 0, len = callbacks.length; i &lt; len; i++) {\n      callbacks[i].apply(this._ctx, args)\n    }\n  }\n\n  return this\n}\n// &#x901A;&#x8FC7;&#x8C03;&#x7528;on&#x4E0E;off&#x4E8B;&#x4EF6;&#x4E8B;&#x4EF6;&#xFF0C;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x89E6;&#x53D1;&#x4E4B;&#x540E;&#x5C31;`off`&#x5BF9;&#x5E94;&#x7684;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;\np.once = function (event, fn) {\n  var self = this\n  this._cbs = this._cbs || {}\n\n  function on () {\n    self.off(event, on)\n    fn.apply(this, arguments)\n  }\n\n  on.fn = fn\n  this.on(event, on)\n  return this\n}\n" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">// &#x5220;&#x53BB;&#x4E86;&#x6CE8;&#x91CA;&#x5E76;&#x4E14;&#x5BF9;&#x4EE3;&#x7801;&#x987A;&#x5E8F;&#x6709;&#x8C03;&#x6574;</span>\n<span class="hljs-comment">// ctx&#x662F;&#x76D1;&#x542C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x4F5C;&#x7528;&#x57DF;(this)</span>\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Emitter</span> (<span class="hljs-params">ctx</span>) </span>{\n  <span class="hljs-keyword">this</span>._ctx = ctx || <span class="hljs-keyword">this</span>\n}\n\n<span class="hljs-keyword">var</span> p = Emitter.prototype\n\np.on = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event, fn</span>) </span>{\n  <span class="hljs-keyword">this</span>._cbs = <span class="hljs-keyword">this</span>._cbs || {}\n  ;(<span class="hljs-keyword">this</span>._cbs[event] || (<span class="hljs-keyword">this</span>._cbs[event] = []))\n    .push(fn)\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>\n}\n<span class="hljs-comment">// &#x4E09;&#x79CD;&#x6A21;&#x5F0F; </span>\n<span class="hljs-comment">// &#x4E0D;&#x4F20;&#x53C2;&#x60C5;&#x51B5;&#x6E05;&#x7A7A;&#x6240;&#x6709;&#x76D1;&#x542C;&#x51FD;&#x6570; </span>\n<span class="hljs-comment">// &#x4EC5;&#x4F20;&#x4E8B;&#x4EF6;&#x540D;&#x5219;&#x6E05;&#x9664;&#x8BE5;&#x4E8B;&#x4EF6;&#x7684;&#x6240;&#x6709;&#x76D1;&#x542C;&#x51FD;&#x6570;</span>\n<span class="hljs-comment">// &#x4F20;&#x9012;&#x4E8B;&#x4EF6;&#x540D;&#x548C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x5219;&#x5BF9;&#x5E94;&#x4EC5;&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;</span>\np.off = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event, fn</span>) </span>{\n  <span class="hljs-keyword">this</span>._cbs = <span class="hljs-keyword">this</span>._cbs || {}\n\n  <span class="hljs-comment">// all</span>\n  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">arguments</span>.length) {\n    <span class="hljs-keyword">this</span>._cbs = {}\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>\n  }\n\n  <span class="hljs-comment">// specific event</span>\n  <span class="hljs-keyword">var</span> callbacks = <span class="hljs-keyword">this</span>._cbs[event]\n  <span class="hljs-keyword">if</span> (!callbacks) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>\n\n  <span class="hljs-comment">// remove all handlers</span>\n  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {\n    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._cbs[event]\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>\n  }\n\n  <span class="hljs-comment">// remove specific handler</span>\n  <span class="hljs-keyword">var</span> cb\n  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; callbacks.length; i++) {\n    cb = callbacks[i]\n    <span class="hljs-comment">// &#x8FD9;&#x8FB9;&#x7684;&#x4EE3;&#x7801;&#x4E4B;&#x6240;&#x4EE5;&#x4F1A;&#x6709;cb.fn === fn&#x8981;&#x7ED3;&#x5408;once&#x51FD;&#x6570;&#x53BB;&#x770B;</span>\n    <span class="hljs-comment">// &#x7ED9;once&#x4F20;&#x9012;&#x7684;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x5176;&#x5B9E;&#x5DF2;&#x7ECF;&#x88AB;wrapped&#x8FC7;</span>\n    <span class="hljs-comment">// &#x4F46;&#x662F;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x539F;&#x6765;&#x7684;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x53BB;off&#x6389;</span>\n    <span class="hljs-keyword">if</span> (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, <span class="hljs-number">1</span>)\n      <span class="hljs-keyword">break</span>\n    }\n  }\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>\n}\n<span class="hljs-comment">// &#x89E6;&#x53D1;&#x5BF9;&#x5E94;&#x4E8B;&#x4EF6;&#x7684;&#x6240;&#x6709;&#x76D1;&#x542C;&#x51FD;&#x6570;&#xFF0C;&#x6CE8;&#x610F;&#x6700;&#x591A;&#x53EA;&#x80FD;&#x7528;&#x7ED9;&#x76D1;&#x542C;&#x51FD;&#x6570;&#x4F20;&#x9012;&#x4E09;&#x4E2A;&#x53C2;&#x6570;(&#x91C7;&#x7528;call)</span>\np.emit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event, a, b, c</span>) </span>{\n  <span class="hljs-keyword">this</span>._cbs = <span class="hljs-keyword">this</span>._cbs || {}\n  <span class="hljs-keyword">var</span> callbacks = <span class="hljs-keyword">this</span>._cbs[event]\n\n  <span class="hljs-keyword">if</span> (callbacks) {\n    callbacks = callbacks.slice(<span class="hljs-number">0</span>)\n    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = callbacks.length; i &lt; len; i++) {\n      callbacks[i].call(<span class="hljs-keyword">this</span>._ctx, a, b, c)\n    }\n  }\n\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>\n}\n<span class="hljs-comment">// &#x89E6;&#x53D1;&#x5BF9;&#x5E94;&#x4E8B;&#x4EF6;&#x7684;&#x6240;&#x6709;&#x76D1;&#x542C;&#x51FD;&#x6570;&#xFF0C;&#x4F20;&#x9012;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x4E0D;&#x53D7;&#x9650;&#x5236;(&#x91C7;&#x7528;apply)</span>\np.applyEmit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{\n  <span class="hljs-keyword">this</span>._cbs = <span class="hljs-keyword">this</span>._cbs || {}\n  <span class="hljs-keyword">var</span> callbacks = <span class="hljs-keyword">this</span>._cbs[event], args\n\n  <span class="hljs-keyword">if</span> (callbacks) {\n    callbacks = callbacks.slice(<span class="hljs-number">0</span>)\n    args = callbacks.slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>)\n    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = callbacks.length; i &lt; len; i++) {\n      callbacks[i].apply(<span class="hljs-keyword">this</span>._ctx, args)\n    }\n  }\n\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>\n}\n<span class="hljs-comment">// &#x901A;&#x8FC7;&#x8C03;&#x7528;on&#x4E0E;off&#x4E8B;&#x4EF6;&#x4E8B;&#x4EF6;&#xFF0C;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x89E6;&#x53D1;&#x4E4B;&#x540E;&#x5C31;`off`&#x5BF9;&#x5E94;&#x7684;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;</span>\np.once = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event, fn</span>) </span>{\n  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>\n  <span class="hljs-keyword">this</span>._cbs = <span class="hljs-keyword">this</span>._cbs || {}\n\n  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span> (<span class="hljs-params"></span>) </span>{\n    self.off(event, on)\n    fn.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>)\n  }\n\n  on.fn = fn\n  <span class="hljs-keyword">this</span>.on(event, on)\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>\n}\n</code></pre><p>&#x3000;&#x3000;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x91C7;&#x7528;&#x4E86;&#x539F;&#x578B;&#x6A21;&#x5F0F;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;<code>Emitter</code>&#x7C7B;&#x3002;&#x914D;&#x5408;Karma&#x8DD1;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x6A21;&#x5757; &#xFF0C;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x5168;&#x90E8;&#x901A;&#x8FC7;&#xFF0C;&#x5230;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x9605;&#x8BFB;&#x5B8C;<code>Emitter</code>&#x4E86;&#xFF0C;&#x8FD9;&#x7B97;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;&#x70ED;&#x8EAB;&#x5427;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x8BA9;&#x6211;&#x4EEC;&#x6B63;&#x5F0F;&#x770B;&#x4E00;&#x4E0B;<code>Observer</code>&#x6A21;&#x5757;&#x3002;<br>&#x3000;&#x3000;</p><h2 id="articleHeader2">Observer</h2><h3 id="articleHeader3">&#x5BF9;&#x5916;&#x529F;&#x80FD;</h3><p>&#x3000;&#x3000;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x601D;&#x8DEF;&#x6211;&#x4EEC;&#x5148;&#x770B;&#x770B;<code>Observer</code>&#x5BF9;&#x5E94;&#x7684;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;<code>observer_spec.js</code>&#xFF0C;&#x7531;&#x4E8E;<code>Observer</code>&#x7684;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x975E;&#x5E38;&#x957F;&#xFF0C;&#x6211;&#x4F1A;&#x5728;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x4E2D;&#x505A;&#x89E3;&#x91CA;&#xFF0C;&#x5E76;&#x5C3D;&#x91CF;&#x7CBE;&#x7B80;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#xFF0C;&#x80FD;&#x8BA9;&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x6A21;&#x5757;&#x5BF9;&#x5E94;&#x529F;&#x80FD;&#x5373;&#x53EF;&#xFF0C;&#x5E0C;&#x671B;&#x4F60;&#x80FD;&#x6709;&#x8010;&#x5FC3;&#x9605;&#x8BFB;&#x4E0B;&#x6765;&#x3002;<br>&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="//&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x662F;&#x7CBE;&#x7B80;&#x7248;&#xFF0C;&#x5426;&#x5219;&#x592A;&#x5197;&#x957F;\nvar Observer = require(&apos;../../../src/observe/observer&apos;)\nvar _ = require(&apos;../../../src/util&apos;) //Vue&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x5DE5;&#x5177;&#x65B9;&#x6CD5;\nvar u = undefined\nObserver.pathDelimiter = &apos;.&apos; //&#x914D;&#x7F6E;Observer&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26;\n\ndescribe(&apos;Observer&apos;, function () {\n\n  var spy\n  beforeEach(function () {\n    spy = jasmine.createSpy(&apos;observer&apos;)\n  })\n//&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x901A;&#x8FC7;Observer.create&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x636E;&#x53D8;&#x4E3A;&#x53EF;&#x54CD;&#x5E94;&#x5316;&#xFF0C;\n//&#x7136;&#x540E;&#x6211;&#x4EEC;&#x76D1;&#x542C;get&#x4E8B;&#x4EF6;&#x53EF;&#x4EE5;&#x5728;&#x5C5E;&#x6027;&#x88AB;&#x8BFB;&#x53D6;&#x65F6;&#x89E6;&#x53D1;&#x5BF9;&#x5E94;&#x4E8B;&#x4EF6;&#xFF0C;&#x6CE8;&#x610F;&#x5BF9;&#x8C61;&#x5D4C;&#x5957;&#x7684;&#x60C5;&#x51B5;(&#x4F8B;&#x5982;b.c)\n  it(&apos;get&apos;, function () {\n    Observer.emitGet = true\n    var obj = {\n      a: 1,\n      b: {\n        c: 2\n      }\n    }\n    var ob = Observer.create(obj)\n    ob.on(&apos;get&apos;, spy)\n\n    var t = obj.b.c\n    expect(spy).toHaveBeenCalledWith(&apos;b&apos;, u, u)\n    expect(spy).toHaveBeenCalledWith(&apos;b.c&apos;, u, u)\n    \n    Observer.emitGet = false\n  })\n//&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76D1;&#x542C;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x7684;set&#x4E8B;&#x4EF6;&#xFF0C;&#x5F53;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x4FEE;&#x6539;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;&#x5BF9;&#x5E94;&#x7684;&#x65F6;&#x95F4;\n  it(&apos;set&apos;, function () {\n    var obj = {\n      a: 1,\n      b: {\n        c: 2\n      }\n    }\n    var ob = Observer.create(obj)\n    ob.on(&apos;set&apos;, spy)\n\n    obj.b.c = 4\n    expect(spy).toHaveBeenCalledWith(&apos;b.c&apos;, 4, u)\n  })\n//&#x5E26;&#x6709;$&#x4E0E;_&#x5F00;&#x5934;&#x7684;&#x5C5E;&#x6027;&#x90FD;&#x4E0D;&#x4F1A;&#x88AB;&#x5904;&#x7406;\n  it(&apos;ignore prefix&apos;, function () {\n    var obj = {\n      _test: 123,\n      $test: 234\n    }\n    var ob = Observer.create(obj)\n    ob.on(&apos;set&apos;, spy)\n    obj._test = 234\n    obj.$test = 345\n    expect(spy.calls.count()).toBe(0)\n  })\n//&#x8BBF;&#x95EE;&#x5668;&#x5C5E;&#x6027;&#x4E5F;&#x4E0D;&#x4F1A;&#x88AB;&#x5904;&#x7406;\n  it(&apos;ignore accessors&apos;, function () {\n    var obj = {\n      a: 123,\n      get b () {\n        return this.a\n      }\n    }\n    var ob = Observer.create(obj)\n    obj.a = 234\n    expect(obj.b).toBe(234)\n  })\n// &#x5BF9;&#x6570;&#x5C5E;&#x6027;&#x7684;get&#x76D1;&#x542C;&#xFF0C;&#x6CE8;&#x610F;&#x5D4C;&#x5957;&#x7684;&#x60C5;&#x51B5;\n  it(&apos;array get&apos;, function () {\n\n    Observer.emitGet = true\n\n    var obj = {\n      arr: [{a:1}, {a:2}]\n    }\n    var ob = Observer.create(obj)\n    ob.on(&apos;get&apos;, spy)\n\n    var t = obj.arr[0].a\n    expect(spy).toHaveBeenCalledWith(&apos;arr&apos;, u, u)\n    expect(spy).toHaveBeenCalledWith(&apos;arr.0.a&apos;, u, u)\n    expect(spy.calls.count()).toBe(2)\n\n    Observer.emitGet = false\n  })\n// &#x5BF9;&#x6570;&#x5C5E;&#x6027;&#x7684;get&#x76D1;&#x542C;&#xFF0C;&#x6CE8;&#x610F;&#x5D4C;&#x5957;&#x7684;&#x60C5;&#x51B5;\n  it(&apos;array set&apos;, function () {\n    var obj = {\n      arr: [{a:1}, {a:2}]\n    }\n    var ob = Observer.create(obj)\n    ob.on(&apos;set&apos;, spy)\n\n    obj.arr[0].a = 2\n    expect(spy).toHaveBeenCalledWith(&apos;arr.0.a&apos;, 2, u)\n  })\n// &#x6211;&#x4EEC;&#x770B;&#x5230;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x76D1;&#x542C;mutate&#x4E8B;&#x4EF6;&#xFF0C;&#x5728;push&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x5BF9;&#x5E94;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;\n// &#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&quot;&quot;&#xFF0C;&#x4EE3;&#x8868;&#x7684;&#x662F;&#x8DEF;&#x5F84;&#x540D;&#xFF0C;&#x5177;&#x4F53;&#x6E90;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5BF9;&#x4E8E;&#x6570;&#x7EC4;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x90FD;&#x662F;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;\n// &#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x6570;&#x7EC4;&#x672C;&#x8EAB;\n// &#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x5176;&#x4E2D;:\n// method&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x89E6;&#x53D1;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x79F0;\n// args&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x89E6;&#x53D1;&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x53C2;&#x6570;\n// result&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x89E6;&#x53D1;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x4E4B;&#x540E;&#x6570;&#x7EC4;&#x7684;&#x7ED3;&#x679C;\n// index&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x5BF9;&#x6570;&#x7EC4;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x6700;&#x5F00;&#x59CB;&#x5143;&#x7D20;\n// inserted&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x6570;&#x7EC4;&#x65B0;&#x589E;&#x7684;&#x5143;&#x7D20;\n// remove&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x6570;&#x7EC4;&#x5220;&#x9664;&#x7684;&#x5143;&#x7D20;\n// &#x5176;&#x4ED6;&#x7684;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;: pop&#x3001;shift&#x3001;unshift&#x3001;splice&#x3001;sort&#x3001;reverse&#x5185;&#x5BB9;&#x90FD;&#x662F;&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#x7684;\n// &#x5177;&#x4F53;&#x6211;&#x4EEC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x5217;&#x4E3E;&#x7684;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7591;&#x95EE;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x770B;&#x5230;&#x5168;&#x90E8;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;\n  it(&apos;array push&apos;, function () {\n    var arr = [{a:1}, {a:2}]\n    var ob = Observer.create(arr)\n    ob.on(&apos;mutate&apos;, spy)\n    arr.push({a:3})\n    expect(spy.calls.mostRecent().args[0]).toBe(&apos;&apos;)\n    expect(spy.calls.mostRecent().args[1]).toBe(arr)\n    var mutation = spy.calls.mostRecent().args[2]\n    expect(mutation).toBeDefined()\n    expect(mutation.method).toBe(&apos;push&apos;)\n    expect(mutation.index).toBe(2)\n    expect(mutation.removed.length).toBe(0)\n    expect(mutation.inserted.length).toBe(1)\n    expect(mutation.inserted[0]).toBe(arr[2])\n  })\n  \n// &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x4E2D;&#x5B58;&#x5728;$add&#x65B9;&#x6CD5;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Vue.set&#xFF0C;&#x53EF;&#x4EE5;&#x76D1;&#x542C;add&#x4E8B;&#x4EF6;\n// &#x53EF;&#x4EE5;&#x5411;&#x54CD;&#x5E94;&#x5F0F;&#x5BF9;&#x8C61;&#x4E2D;&#x6DFB;&#x52A0;&#x65B0;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x4E4B;&#x524D;&#x5B58;&#x5728;&#x8BE5;&#x5C5E;&#x6027;&#x5219;&#x64CD;&#x4F5C;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;\n// &#x5E76;&#x4E14;&#x65B0;&#x8D4B;&#x503C;&#x7684;&#x5BF9;&#x8C61;&#x4E5F;&#x5FC5;&#x987B;&#x88AB;&#x54CD;&#x5E94;&#x5316;\n// &#x6211;&#x4EEC;&#x7701;&#x7565;&#x4E86;&#x5BF9;&#x8C61;&#x6570;&#x636E;$delete&#x65B9;&#x6CD5;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x529F;&#x80FD;&#x7C7B;&#x4F3C;&#x4E8E;Vue.delete&#xFF0C;&#x4E0E;$add&#x65B9;&#x6CD5;&#x76F8;&#x53CD;,&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;\n// &#x6211;&#x4EEC;&#x7701;&#x7565;&#x4E86;&#x6570;&#x7EC4;&#x7684;$set&#x65B9;&#x6CD5;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x529F;&#x80FD;&#x4E5F;&#x7C7B;&#x4F3C;&#x4E0E;Vue.set&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x6570;&#x7EC4;&#x5BF9;&#x5E94;&#x6570;&#x5B57;&#x4E0B;&#x6807;&#x7684;&#x503C;\n// &#x6211;&#x4EEC;&#x7701;&#x7565;&#x4E86;&#x6570;&#x7EC4;&#x7684;$remove&#x65B9;&#x6CD5;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x529F;&#x80FD;&#x7528;&#x4E8E;&#x79FB;&#x9664;&#x6570;&#x7EC4;&#x7ED9;&#x5B9A;&#x4E0B;&#x6807;&#x7684;&#x503C;&#x6216;&#x8005;&#x7ED9;&#x5B9A;&#x7684;&#x503C;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;\n// var arr = [{a:1}, {a:2}]\n// var ob = Observer.create(arr)\n// arr.$remove(0) =&gt; &#x79FB;&#x9664;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x7684;&#x503C; &#x6216;&#x8005;\n// arr.$remove(arr[0]) =&gt; &#x79FB;&#x9664;&#x7ED9;&#x5B9A;&#x7684;&#x503C;\n\n  it(&apos;object.$add&apos;, function () {\n    var obj = {a:{b:1"}}"\n    var ob = Observer.create(obj)\n    ob.on(&apos;add&apos;, spy)\n\n    // ignore existing keys\n    obj.$add(&apos;a&apos;, 123)\n    expect(spy.calls.count()).toBe(0)\n\n    // add event\n    var add = {d:2}\n    obj.a.$add(&apos;c&apos;, add)\n    expect(spy).toHaveBeenCalledWith(&apos;a.c&apos;, add, u)\n\n    // check if add object is properly observed\n    ob.on(&apos;set&apos;, spy)\n    obj.a.c.d = 3\n    expect(spy).toHaveBeenCalledWith(&apos;a.c.d&apos;, 3, u)\n  })\n\n// &#x4E0B;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x7528;&#x6765;&#x8868;&#x793A;&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x5BF9;&#x8C61;parentA&#x3001;parentB&#x7684;&#x5C5E;&#x6027;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;obj&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x5BF9;&#x8C61;obj&#x6539;&#x53D8;&#x65F6;&#x4F1A;&#x5206;&#x522B;parentA&#x4E0E;parentB&#x7684;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;\n\n  it(&apos;shared observe&apos;, function () {\n    var obj = { a: 1 }\n    var parentA = { child1: obj }\n    var parentB = { child2: obj }\n    var obA = Observer.create(parentA)\n    var obB = Observer.create(parentB)\n    obA.on(&apos;set&apos;, spy)\n    obB.on(&apos;set&apos;, spy)\n    obj.a = 2\n    expect(spy.calls.count()).toBe(2)\n    expect(spy).toHaveBeenCalledWith(&apos;child1.a&apos;, 2, u)\n    expect(spy).toHaveBeenCalledWith(&apos;child2.a&apos;, 2, u)\n    // test unobserve\n    parentA.child1 = null\n    obj.a = 3\n    expect(spy.calls.count()).toBe(4)\n    expect(spy).toHaveBeenCalledWith(&apos;child1&apos;, null, u)\n    expect(spy).toHaveBeenCalledWith(&apos;child2.a&apos;, 3, u)\n  })\n\n})" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">//&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x662F;&#x7CBE;&#x7B80;&#x7248;&#xFF0C;&#x5426;&#x5219;&#x592A;&#x5197;&#x957F;</span>\n<span class="hljs-keyword">var</span> Observer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;../../../src/observe/observer&apos;</span>)\n<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;../../../src/util&apos;</span>) <span class="hljs-comment">//Vue&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x5DE5;&#x5177;&#x65B9;&#x6CD5;</span>\n<span class="hljs-keyword">var</span> u = <span class="hljs-literal">undefined</span>\nObserver.pathDelimiter = <span class="hljs-string">&apos;.&apos;</span> <span class="hljs-comment">//&#x914D;&#x7F6E;Observer&#x8DEF;&#x5F84;&#x5206;&#x9694;&#x7B26;</span>\n\ndescribe(<span class="hljs-string">&apos;Observer&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n\n  <span class="hljs-keyword">var</span> spy\n  beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    spy = jasmine.createSpy(<span class="hljs-string">&apos;observer&apos;</span>)\n  })\n<span class="hljs-comment">//&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x901A;&#x8FC7;Observer.create&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x5C06;&#x6570;&#x636E;&#x53D8;&#x4E3A;&#x53EF;&#x54CD;&#x5E94;&#x5316;&#xFF0C;</span>\n<span class="hljs-comment">//&#x7136;&#x540E;&#x6211;&#x4EEC;&#x76D1;&#x542C;get&#x4E8B;&#x4EF6;&#x53EF;&#x4EE5;&#x5728;&#x5C5E;&#x6027;&#x88AB;&#x8BFB;&#x53D6;&#x65F6;&#x89E6;&#x53D1;&#x5BF9;&#x5E94;&#x4E8B;&#x4EF6;&#xFF0C;&#x6CE8;&#x610F;&#x5BF9;&#x8C61;&#x5D4C;&#x5957;&#x7684;&#x60C5;&#x51B5;(&#x4F8B;&#x5982;b.c)</span>\n  it(<span class="hljs-string">&apos;get&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    Observer.emitGet = <span class="hljs-literal">true</span>\n    <span class="hljs-keyword">var</span> obj = {\n      <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,\n      <span class="hljs-attr">b</span>: {\n        <span class="hljs-attr">c</span>: <span class="hljs-number">2</span>\n      }\n    }\n    <span class="hljs-keyword">var</span> ob = Observer.create(obj)\n    ob.on(<span class="hljs-string">&apos;get&apos;</span>, spy)\n\n    <span class="hljs-keyword">var</span> t = obj.b.c\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;b&apos;</span>, u, u)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;b.c&apos;</span>, u, u)\n    \n    Observer.emitGet = <span class="hljs-literal">false</span>\n  })\n<span class="hljs-comment">//&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76D1;&#x542C;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x7684;set&#x4E8B;&#x4EF6;&#xFF0C;&#x5F53;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x4FEE;&#x6539;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;&#x5BF9;&#x5E94;&#x7684;&#x65F6;&#x95F4;</span>\n  it(<span class="hljs-string">&apos;set&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    <span class="hljs-keyword">var</span> obj = {\n      <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,\n      <span class="hljs-attr">b</span>: {\n        <span class="hljs-attr">c</span>: <span class="hljs-number">2</span>\n      }\n    }\n    <span class="hljs-keyword">var</span> ob = Observer.create(obj)\n    ob.on(<span class="hljs-string">&apos;set&apos;</span>, spy)\n\n    obj.b.c = <span class="hljs-number">4</span>\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;b.c&apos;</span>, <span class="hljs-number">4</span>, u)\n  })\n<span class="hljs-comment">//&#x5E26;&#x6709;$&#x4E0E;_&#x5F00;&#x5934;&#x7684;&#x5C5E;&#x6027;&#x90FD;&#x4E0D;&#x4F1A;&#x88AB;&#x5904;&#x7406;</span>\n  it(<span class="hljs-string">&apos;ignore prefix&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    <span class="hljs-keyword">var</span> obj = {\n      <span class="hljs-attr">_test</span>: <span class="hljs-number">123</span>,\n      <span class="hljs-attr">$test</span>: <span class="hljs-number">234</span>\n    }\n    <span class="hljs-keyword">var</span> ob = Observer.create(obj)\n    ob.on(<span class="hljs-string">&apos;set&apos;</span>, spy)\n    obj._test = <span class="hljs-number">234</span>\n    obj.$test = <span class="hljs-number">345</span>\n    expect(spy.calls.count()).toBe(<span class="hljs-number">0</span>)\n  })\n<span class="hljs-comment">//&#x8BBF;&#x95EE;&#x5668;&#x5C5E;&#x6027;&#x4E5F;&#x4E0D;&#x4F1A;&#x88AB;&#x5904;&#x7406;</span>\n  it(<span class="hljs-string">&apos;ignore accessors&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    <span class="hljs-keyword">var</span> obj = {\n      <span class="hljs-attr">a</span>: <span class="hljs-number">123</span>,\n      get b () {\n        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.a\n      }\n    }\n    <span class="hljs-keyword">var</span> ob = Observer.create(obj)\n    obj.a = <span class="hljs-number">234</span>\n    expect(obj.b).toBe(<span class="hljs-number">234</span>)\n  })\n<span class="hljs-comment">// &#x5BF9;&#x6570;&#x5C5E;&#x6027;&#x7684;get&#x76D1;&#x542C;&#xFF0C;&#x6CE8;&#x610F;&#x5D4C;&#x5957;&#x7684;&#x60C5;&#x51B5;</span>\n  it(<span class="hljs-string">&apos;array get&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n\n    Observer.emitGet = <span class="hljs-literal">true</span>\n\n    <span class="hljs-keyword">var</span> obj = {\n      <span class="hljs-attr">arr</span>: [{<span class="hljs-attr">a</span>:<span class="hljs-number">1</span>}, {<span class="hljs-attr">a</span>:<span class="hljs-number">2</span>}]\n    }\n    <span class="hljs-keyword">var</span> ob = Observer.create(obj)\n    ob.on(<span class="hljs-string">&apos;get&apos;</span>, spy)\n\n    <span class="hljs-keyword">var</span> t = obj.arr[<span class="hljs-number">0</span>].a\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;arr&apos;</span>, u, u)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;arr.0.a&apos;</span>, u, u)\n    expect(spy.calls.count()).toBe(<span class="hljs-number">2</span>)\n\n    Observer.emitGet = <span class="hljs-literal">false</span>\n  })\n<span class="hljs-comment">// &#x5BF9;&#x6570;&#x5C5E;&#x6027;&#x7684;get&#x76D1;&#x542C;&#xFF0C;&#x6CE8;&#x610F;&#x5D4C;&#x5957;&#x7684;&#x60C5;&#x51B5;</span>\n  it(<span class="hljs-string">&apos;array set&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    <span class="hljs-keyword">var</span> obj = {\n      <span class="hljs-attr">arr</span>: [{<span class="hljs-attr">a</span>:<span class="hljs-number">1</span>}, {<span class="hljs-attr">a</span>:<span class="hljs-number">2</span>}]\n    }\n    <span class="hljs-keyword">var</span> ob = Observer.create(obj)\n    ob.on(<span class="hljs-string">&apos;set&apos;</span>, spy)\n\n    obj.arr[<span class="hljs-number">0</span>].a = <span class="hljs-number">2</span>\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;arr.0.a&apos;</span>, <span class="hljs-number">2</span>, u)\n  })\n<span class="hljs-comment">// &#x6211;&#x4EEC;&#x770B;&#x5230;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x76D1;&#x542C;mutate&#x4E8B;&#x4EF6;&#xFF0C;&#x5728;push&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x5BF9;&#x5E94;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;</span>\n<span class="hljs-comment">// &#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&quot;&quot;&#xFF0C;&#x4EE3;&#x8868;&#x7684;&#x662F;&#x8DEF;&#x5F84;&#x540D;&#xFF0C;&#x5177;&#x4F53;&#x6E90;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5BF9;&#x4E8E;&#x6570;&#x7EC4;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x90FD;&#x662F;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;</span>\n<span class="hljs-comment">// &#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x6570;&#x7EC4;&#x672C;&#x8EAB;</span>\n<span class="hljs-comment">// &#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x5176;&#x4E2D;:</span>\n<span class="hljs-comment">// method&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x89E6;&#x53D1;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x79F0;</span>\n<span class="hljs-comment">// args&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x89E6;&#x53D1;&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x53C2;&#x6570;</span>\n<span class="hljs-comment">// result&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x89E6;&#x53D1;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x4E4B;&#x540E;&#x6570;&#x7EC4;&#x7684;&#x7ED3;&#x679C;</span>\n<span class="hljs-comment">// index&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x5BF9;&#x6570;&#x7EC4;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x6700;&#x5F00;&#x59CB;&#x5143;&#x7D20;</span>\n<span class="hljs-comment">// inserted&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x6570;&#x7EC4;&#x65B0;&#x589E;&#x7684;&#x5143;&#x7D20;</span>\n<span class="hljs-comment">// remove&#x5C5E;&#x6027;: &#x4EE3;&#x8868;&#x6570;&#x7EC4;&#x5220;&#x9664;&#x7684;&#x5143;&#x7D20;</span>\n<span class="hljs-comment">// &#x5176;&#x4ED6;&#x7684;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;: pop&#x3001;shift&#x3001;unshift&#x3001;splice&#x3001;sort&#x3001;reverse&#x5185;&#x5BB9;&#x90FD;&#x662F;&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#x7684;</span>\n<span class="hljs-comment">// &#x5177;&#x4F53;&#x6211;&#x4EEC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x5217;&#x4E3E;&#x7684;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7591;&#x95EE;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x770B;&#x5230;&#x5168;&#x90E8;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;</span>\n  it(<span class="hljs-string">&apos;array push&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    <span class="hljs-keyword">var</span> arr = [{<span class="hljs-attr">a</span>:<span class="hljs-number">1</span>}, {<span class="hljs-attr">a</span>:<span class="hljs-number">2</span>}]\n    <span class="hljs-keyword">var</span> ob = Observer.create(arr)\n    ob.on(<span class="hljs-string">&apos;mutate&apos;</span>, spy)\n    arr.push({<span class="hljs-attr">a</span>:<span class="hljs-number">3</span>})\n    expect(spy.calls.mostRecent().args[<span class="hljs-number">0</span>]).toBe(<span class="hljs-string">&apos;&apos;</span>)\n    expect(spy.calls.mostRecent().args[<span class="hljs-number">1</span>]).toBe(arr)\n    <span class="hljs-keyword">var</span> mutation = spy.calls.mostRecent().args[<span class="hljs-number">2</span>]\n    expect(mutation).toBeDefined()\n    expect(mutation.method).toBe(<span class="hljs-string">&apos;push&apos;</span>)\n    expect(mutation.index).toBe(<span class="hljs-number">2</span>)\n    expect(mutation.removed.length).toBe(<span class="hljs-number">0</span>)\n    expect(mutation.inserted.length).toBe(<span class="hljs-number">1</span>)\n    expect(mutation.inserted[<span class="hljs-number">0</span>]).toBe(arr[<span class="hljs-number">2</span>])\n  })\n  \n<span class="hljs-comment">// &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x4E2D;&#x5B58;&#x5728;$add&#x65B9;&#x6CD5;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;Vue.set&#xFF0C;&#x53EF;&#x4EE5;&#x76D1;&#x542C;add&#x4E8B;&#x4EF6;</span>\n<span class="hljs-comment">// &#x53EF;&#x4EE5;&#x5411;&#x54CD;&#x5E94;&#x5F0F;&#x5BF9;&#x8C61;&#x4E2D;&#x6DFB;&#x52A0;&#x65B0;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x4E4B;&#x524D;&#x5B58;&#x5728;&#x8BE5;&#x5C5E;&#x6027;&#x5219;&#x64CD;&#x4F5C;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;</span>\n<span class="hljs-comment">// &#x5E76;&#x4E14;&#x65B0;&#x8D4B;&#x503C;&#x7684;&#x5BF9;&#x8C61;&#x4E5F;&#x5FC5;&#x987B;&#x88AB;&#x54CD;&#x5E94;&#x5316;</span>\n<span class="hljs-comment">// &#x6211;&#x4EEC;&#x7701;&#x7565;&#x4E86;&#x5BF9;&#x8C61;&#x6570;&#x636E;$delete&#x65B9;&#x6CD5;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x529F;&#x80FD;&#x7C7B;&#x4F3C;&#x4E8E;Vue.delete&#xFF0C;&#x4E0E;$add&#x65B9;&#x6CD5;&#x76F8;&#x53CD;,&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;</span>\n<span class="hljs-comment">// &#x6211;&#x4EEC;&#x7701;&#x7565;&#x4E86;&#x6570;&#x7EC4;&#x7684;$set&#x65B9;&#x6CD5;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x529F;&#x80FD;&#x4E5F;&#x7C7B;&#x4F3C;&#x4E0E;Vue.set&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x6570;&#x7EC4;&#x5BF9;&#x5E94;&#x6570;&#x5B57;&#x4E0B;&#x6807;&#x7684;&#x503C;</span>\n<span class="hljs-comment">// &#x6211;&#x4EEC;&#x7701;&#x7565;&#x4E86;&#x6570;&#x7EC4;&#x7684;$remove&#x65B9;&#x6CD5;&#x7684;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF0C;&#x529F;&#x80FD;&#x7528;&#x4E8E;&#x79FB;&#x9664;&#x6570;&#x7EC4;&#x7ED9;&#x5B9A;&#x4E0B;&#x6807;&#x7684;&#x503C;&#x6216;&#x8005;&#x7ED9;&#x5B9A;&#x7684;&#x503C;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</span>\n<span class="hljs-comment">// var arr = [{a:1}, {a:2}]</span>\n<span class="hljs-comment">// var ob = Observer.create(arr)</span>\n<span class="hljs-comment">// arr.$remove(0) =&gt; &#x79FB;&#x9664;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x7684;&#x503C; &#x6216;&#x8005;</span>\n<span class="hljs-comment">// arr.$remove(arr[0]) =&gt; &#x79FB;&#x9664;&#x7ED9;&#x5B9A;&#x7684;&#x503C;</span>\n\n  it(<span class="hljs-string">&apos;object.$add&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    <span class="hljs-keyword">var</span> obj = {<span class="hljs-attr">a</span>:{<span class="hljs-attr">b</span>:<span class="hljs-number">1</span>"}}"\n    <span class="hljs-keyword">var</span> ob = Observer.create(obj)\n    ob.on(<span class="hljs-string">&apos;add&apos;</span>, spy)\n\n    <span class="hljs-comment">// ignore existing keys</span>\n    obj.$add(<span class="hljs-string">&apos;a&apos;</span>, <span class="hljs-number">123</span>)\n    expect(spy.calls.count()).toBe(<span class="hljs-number">0</span>)\n\n    <span class="hljs-comment">// add event</span>\n    <span class="hljs-keyword">var</span> add = {<span class="hljs-attr">d</span>:<span class="hljs-number">2</span>}\n    obj.a.$add(<span class="hljs-string">&apos;c&apos;</span>, add)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;a.c&apos;</span>, add, u)\n\n    <span class="hljs-comment">// check if add object is properly observed</span>\n    ob.on(<span class="hljs-string">&apos;set&apos;</span>, spy)\n    obj.a.c.d = <span class="hljs-number">3</span>\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;a.c.d&apos;</span>, <span class="hljs-number">3</span>, u)\n  })\n\n<span class="hljs-comment">// &#x4E0B;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x7528;&#x6765;&#x8868;&#x793A;&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x5BF9;&#x8C61;parentA&#x3001;parentB&#x7684;&#x5C5E;&#x6027;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;obj&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x5BF9;&#x8C61;obj&#x6539;&#x53D8;&#x65F6;&#x4F1A;&#x5206;&#x522B;parentA&#x4E0E;parentB&#x7684;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;</span>\n\n  it(<span class="hljs-string">&apos;shared observe&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    <span class="hljs-keyword">var</span> obj = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }\n    <span class="hljs-keyword">var</span> parentA = { <span class="hljs-attr">child1</span>: obj }\n    <span class="hljs-keyword">var</span> parentB = { <span class="hljs-attr">child2</span>: obj }\n    <span class="hljs-keyword">var</span> obA = Observer.create(parentA)\n    <span class="hljs-keyword">var</span> obB = Observer.create(parentB)\n    obA.on(<span class="hljs-string">&apos;set&apos;</span>, spy)\n    obB.on(<span class="hljs-string">&apos;set&apos;</span>, spy)\n    obj.a = <span class="hljs-number">2</span>\n    expect(spy.calls.count()).toBe(<span class="hljs-number">2</span>)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;child1.a&apos;</span>, <span class="hljs-number">2</span>, u)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;child2.a&apos;</span>, <span class="hljs-number">2</span>, u)\n    <span class="hljs-comment">// test unobserve</span>\n    parentA.child1 = <span class="hljs-literal">null</span>\n    obj.a = <span class="hljs-number">3</span>\n    expect(spy.calls.count()).toBe(<span class="hljs-number">4</span>)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;child1&apos;</span>, <span class="hljs-literal">null</span>, u)\n    expect(spy).toHaveBeenCalledWith(<span class="hljs-string">&apos;child2.a&apos;</span>, <span class="hljs-number">3</span>, u)\n  })\n\n})</code></pre><h3 id="articleHeader4">&#x6E90;&#x7801;&#x5B9E;&#x73B0;</h3><h4>&#x6570;&#x7EC4;</h4><p>&#x3000;&#x3000;&#x80FD;&#x575A;&#x6301;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x957F;&#x5F81;&#x8DEF;&#x5C31;&#x8D70;&#x8FC7;&#x4E86;&#x4E00;&#x534A;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;<code>Oberver</code>&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x7684;&#x529F;&#x80FD;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;<code>Oberver</code>&#x5185;&#x90E8;&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;<br>&#x3000;&#x3000;<br>&#x3000;&#x3000;<code>Oberver</code>&#x6A21;&#x5757;&#x5B9E;&#x9645;&#x4E0A;&#x91C7;&#x7528;&#x91C7;&#x7528;<strong>&#x7EC4;&#x5408;&#x7EE7;&#x627F;</strong>(<strong>&#x501F;&#x7528;&#x6784;&#x9020;&#x51FD;&#x6570;</strong>+<strong>&#x539F;&#x578B;&#x7EE7;&#x627F;</strong>)&#x65B9;&#x5F0F;&#x7EE7;&#x627F;&#x4E86;<code>Emitter</code>,&#x5176;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x7EE7;&#x627F;<code>Emitter</code>&#x7684;<code>on</code>, <code>off</code>&#xFF0C;<code>emit</code>&#x7B49;&#x65B9;&#x6CD5;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x53D1;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x7528;<code>new</code>&#x65B9;&#x6CD5;&#x76F4;&#x63A5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>Oberver</code>&#x7684;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#xFF0C;&#x800C;&#x662F;&#x91C7;&#x7528;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;<code>Oberver.create</code>&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x6E90;&#x7801;&#xFF0C;&#x7531;&#x4E8E;&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x591A;&#x6211;&#x4F1A;&#x5C3D;&#x91CF;&#x53BB;&#x62C6;&#x5206;&#x6210;&#x4E00;&#x4E2A;&#x4E2A;&#x5C0F;&#x5757;&#x6765;&#x8BB2;&#xFF1A;<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// &#x4EE3;&#x7801;&#x51FA;&#x81EA;&#x4E8E;observe.js\n// &#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x8BB2;&#x89E3;&#x6211;&#x5BF9;&#x4EE3;&#x7801;&#x987A;&#x5E8F;&#x505A;&#x4E86;&#x6539;&#x53D8;&#xFF0C;&#x8981;&#x4E86;&#x89E3;&#x8BE6;&#x7EC6;&#x7684;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5177;&#x4F53;&#x7684;&#x6E90;&#x7801;\n\nvar _ = require(&apos;../util&apos;)\nvar Emitter = require(&apos;../emitter&apos;)\nvar arrayAugmentations = require(&apos;./array-augmentations&apos;)\nvar objectAugmentations = require(&apos;./object-augmentations&apos;)\n\nvar uid = 0\n/**\n * Type enums\n */\n\nvar ARRAY  = 0\nvar OBJECT = 1\n\nfunction Observer (value, type, options) {\n  Emitter.call(this, options &amp;&amp; options.callbackContext)\n  this.id = ++uid\n  this.value = value\n  this.type = type\n  this.parents = null\n  if (value) {\n    _.define(value, &apos;$observer&apos;, this)\n    if (type === ARRAY) {\n      _.augment(value, arrayAugmentations)\n      this.link(value)\n    } else if (type === OBJECT) {\n      if (options &amp;&amp; options.doNotAlterProto) {\n        _.deepMixin(value, objectAugmentations)\n      } else {\n        _.augment(value, objectAugmentations)\n      }\n      this.walk(value)\n    }\n  }\n}\n\nvar p = Observer.prototype = Object.create(Emitter.prototype)\n\nObserver.pathDelimiter = &apos;\\b&apos;\n\nObserver.emitGet = false\n\nObserver.create = function (value, options) {\n  if (value &amp;&amp;\n      value.hasOwnProperty(&apos;$observer&apos;) &amp;&amp;\n      value.$observer instanceof Observer) {\n    return value.$observer\n  } if (_.isArray(value)) {\n    return new Observer(value, ARRAY, options)\n  } else if (\n    _.isObject(value) &amp;&amp;\n    !value.$scope // avoid Vue instance\n  ) {\n    return new Observer(value, OBJECT, options)\n  }\n}\n" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">// &#x4EE3;&#x7801;&#x51FA;&#x81EA;&#x4E8E;observe.js</span>\n<span class="hljs-comment">// &#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x8BB2;&#x89E3;&#x6211;&#x5BF9;&#x4EE3;&#x7801;&#x987A;&#x5E8F;&#x505A;&#x4E86;&#x6539;&#x53D8;&#xFF0C;&#x8981;&#x4E86;&#x89E3;&#x8BE6;&#x7EC6;&#x7684;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5177;&#x4F53;&#x7684;&#x6E90;&#x7801;</span>\n\n<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;../util&apos;</span>)\n<span class="hljs-keyword">var</span> Emitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;../emitter&apos;</span>)\n<span class="hljs-keyword">var</span> arrayAugmentations = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;./array-augmentations&apos;</span>)\n<span class="hljs-keyword">var</span> objectAugmentations = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;./object-augmentations&apos;</span>)\n\n<span class="hljs-keyword">var</span> uid = <span class="hljs-number">0</span>\n<span class="hljs-comment">/**\n * Type enums\n */</span>\n\n<span class="hljs-keyword">var</span> ARRAY  = <span class="hljs-number">0</span>\n<span class="hljs-keyword">var</span> OBJECT = <span class="hljs-number">1</span>\n\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Observer</span> (<span class="hljs-params">value, type, options</span>) </span>{\n  Emitter.call(<span class="hljs-keyword">this</span>, options &amp;&amp; options.callbackContext)\n  <span class="hljs-keyword">this</span>.id = ++uid\n  <span class="hljs-keyword">this</span>.value = value\n  <span class="hljs-keyword">this</span>.type = type\n  <span class="hljs-keyword">this</span>.parents = <span class="hljs-literal">null</span>\n  <span class="hljs-keyword">if</span> (value) {\n    _.define(value, <span class="hljs-string">&apos;$observer&apos;</span>, <span class="hljs-keyword">this</span>)\n    <span class="hljs-keyword">if</span> (type === ARRAY) {\n      _.augment(value, arrayAugmentations)\n      <span class="hljs-keyword">this</span>.link(value)\n    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === OBJECT) {\n      <span class="hljs-keyword">if</span> (options &amp;&amp; options.doNotAlterProto) {\n        _.deepMixin(value, objectAugmentations)\n      } <span class="hljs-keyword">else</span> {\n        _.augment(value, objectAugmentations)\n      }\n      <span class="hljs-keyword">this</span>.walk(value)\n    }\n  }\n}\n\n<span class="hljs-keyword">var</span> p = Observer.prototype = <span class="hljs-built_in">Object</span>.create(Emitter.prototype)\n\nObserver.pathDelimiter = <span class="hljs-string">&apos;\\b&apos;</span>\n\nObserver.emitGet = <span class="hljs-literal">false</span>\n\nObserver.create = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value, options</span>) </span>{\n  <span class="hljs-keyword">if</span> (value &amp;&amp;\n      value.hasOwnProperty(<span class="hljs-string">&apos;$observer&apos;</span>) &amp;&amp;\n      value.$observer <span class="hljs-keyword">instanceof</span> Observer) {\n    <span class="hljs-keyword">return</span> value.$observer\n  } <span class="hljs-keyword">if</span> (_.isArray(value)) {\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Observer(value, ARRAY, options)\n  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (\n    _.isObject(value) &amp;&amp;\n    !value.$scope <span class="hljs-comment">// avoid Vue instance</span>\n  ) {\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Observer(value, OBJECT, options)\n  }\n}\n</code></pre><p>&#x3000;&#x3000;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x4ECE;<code>Observer.create</code>&#x770B;&#x8D77;&#xFF0C;&#x5982;&#x679C;<code>value</code>&#x503C;&#x6CA1;&#x6709;&#x54CD;&#x5E94;&#x5316;&#x8FC7;(&#x901A;&#x8FC7;&#x662F;&#x5426;&#x542B;&#x6709;<code>$observer</code>&#x5C5E;&#x6027;&#x53BB;&#x5224;&#x65AD;)&#xFF0C;&#x5219;&#x4F7F;&#x7528;new&#x64CD;&#x4F5C;&#x7B26;&#x521B;&#x5EFA;Obsever&#x5B9E;&#x4F8B;(&#x533A;&#x5206;&#x5BF9;&#x8C61;OBJECT&#x4E0E;&#x6570;&#x7EC4;ARRAY)&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x770B;<code>Observer</code>&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;&#x600E;&#x4E48;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x9996;&#x5148;&#x501F;&#x7528;<code>Emitter</code>&#x6784;&#x9020;&#x51FD;&#x6570;:<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="Emitter.call(this, options &amp;&amp; options.callbackContext)" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript" style="word-break:break-word;white-space:initial">Emitter.call(<span class="hljs-keyword">this</span>, options &amp;&amp; options.callbackContext)</code></pre><p>&#x914D;&#x5408;&#x539F;&#x578B;&#x7EE7;&#x627F;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="var p = Observer.prototype = Object.create(Emitter.prototype)" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript" style="word-break:break-word;white-space:initial"><span class="hljs-keyword">var</span> p = Observer.prototype = <span class="hljs-built_in">Object</span>.create(Emitter.prototype)</code></pre><p>&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4E86;&#x7EC4;&#x5408;&#x7EE7;&#x627F;<code>Emitter</code>&#xFF0C;&#x56E0;&#x6B64;<code>Observer</code>&#x7EE7;&#x627F;&#x4E86;<code>Emitter</code>&#x7684;&#x5C5E;&#x6027;(<code>ctx</code>)&#x548C;&#x65B9;&#x6CD5;(<code>on</code>,<code>emit</code>&#x7B49;)&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;<code>Observer</code>&#x6709;&#x4EE5;&#x4E0B;&#x5C5E;&#x6027;:</p><ul><li><code>id</code>: &#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x7684;&#x552F;&#x4E00;&#x6807;&#x8BC6;</li><li><code>value</code>: &#x539F;&#x59CB;&#x6570;&#x636E;</li><li><code>type</code>: &#x6807;&#x8BC6;&#x662F;&#x6570;&#x7EC4;&#x8FD8;&#x662F;&#x5BF9;&#x8C61;</li><li><code>parents</code>: &#x6807;&#x8BC6;&#x54CD;&#x5E94;&#x5F0F;&#x6570;&#x636E;&#x7684;&#x7236;&#x7EA7;&#xFF0C;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#xFF0C;&#x6BD4;&#x5982;<code>var obj = { a : { b: 1"}}"</code>,&#x5728;&#x5904;&#x7406;<code>{b: 1}</code>&#x7684;&#x54CD;&#x5E94;&#x5316;&#x8FC7;&#x7A0B;&#x4E2D;<code>parents</code>&#x4E2D;&#x67D0;&#x4E2A;&#x5C5E;&#x6027;&#x6307;&#x5411;&#x7684;&#x5C31;&#x662F;<code>obj</code>&#x7684;<code>$observer</code>&#x3002;</li></ul><p>&#x3000;&#x3000;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x770B;&#x9996;&#x5148;&#x7ED9;&#x8BE5;&#x6570;&#x636E;&#x8D4B;&#x503C;<code>$observer</code>&#x5C5E;&#x6027;&#xFF0C;&#x6307;&#x5411;&#x7684;&#x662F;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x672C;&#x8EAB;&#x3002;<code>_.define</code>&#x5185;&#x90E8;&#x662F;&#x901A;&#x8FC7;<code>defineProperty</code>&#x5B9E;&#x73B0;&#x7684;:</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="define = function (obj, key, val, enumerable) {\n  Object.defineProperty(obj, key, {\n    value        : val,\n    enumerable   : !!enumerable,\n    writable     : true,\n    configurable : true\n  })\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript">define = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj, key, val, enumerable</span>) </span>{\n  <span class="hljs-built_in">Object</span>.defineProperty(obj, key, {\n    <span class="hljs-attr">value</span>        : val,\n    <span class="hljs-attr">enumerable</span>   : !!enumerable,\n    <span class="hljs-attr">writable</span>     : <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">configurable</span> : <span class="hljs-literal">true</span>\n  })\n}</code></pre><p>&#x3000;&#x3000;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x770B;&#x770B;&#x662F;&#x600E;&#x4E48;&#x5904;&#x7406;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x7684;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="if (type === ARRAY) {\n    _.augment(value, arrayAugmentations)\n    this.link(value)\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-keyword">if</span> (type === ARRAY) {\n    _.augment(value, arrayAugmentations)\n    <span class="hljs-keyword">this</span>.link(value)\n}</code></pre><p>&#x3000;&#x3000;&#x5982;&#x679C;&#x770B;&#x8FC7;&#x6211;&#x524D;&#x4E24;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x540C;&#x5B66;&#xFF0C;&#x5176;&#x5B9E;&#x8FD8;&#x8BB0;&#x5F97;&#x6211;&#x4EEC;&#x5BF9;&#x6570;&#x7EC4;&#x54CD;&#x5E94;&#x5316;&#x5F53;&#x65F6;&#x8FD8;&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x7740;&#x91CD;&#x7684;&#x539F;&#x7406;&#x8BB2;&#x89E3;&#xFF0C;&#x5927;&#x6982;&#x539F;&#x7406;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x7ED9;&#x6570;&#x7EC4;&#x5BF9;&#x8C61;&#x8BBE;&#x7F6E;&#x65B0;&#x7684;&#x539F;&#x578B;&#x5BF9;&#x8C61;&#xFF0C;&#x4ECE;&#x800C;&#x906E;&#x853D;&#x6389;&#x539F;&#x751F;&#x6570;&#x7EC4;&#x7684;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#xFF0C;&#x5927;&#x6982;&#x7684;&#x539F;&#x7406;&#x53EF;&#x4EE5;&#x662F;&#xFF1A;<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="function observifyArray(array){\n    var aryMethods = [&apos;push&apos;, &apos;pop&apos;, &apos;shift&apos;, &apos;unshift&apos;, &apos;splice&apos;, &apos;sort&apos;, &apos;reverse&apos;];\n    var arrayAugmentations = Object.create(Array.prototype);\n    aryMethods.forEach((method)=&gt; {\n        let original = Array.prototype[method];\n        arrayAugmentations[method] = function () {\n            // &#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x539F;&#x751F;&#x65B9;&#x6CD5;&#x5E76;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;\n            // do everything you what do !\n            return original.apply(this, arguments);\n        };\n    });\n    array.__proto__ = arrayAugmentations;\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">observifyArray</span>(<span class="hljs-params">array</span>)</span>{\n    <span class="hljs-keyword">var</span> aryMethods = [<span class="hljs-string">&apos;push&apos;</span>, <span class="hljs-string">&apos;pop&apos;</span>, <span class="hljs-string">&apos;shift&apos;</span>, <span class="hljs-string">&apos;unshift&apos;</span>, <span class="hljs-string">&apos;splice&apos;</span>, <span class="hljs-string">&apos;sort&apos;</span>, <span class="hljs-string">&apos;reverse&apos;</span>];\n    <span class="hljs-keyword">var</span> arrayAugmentations = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Array</span>.prototype);\n    aryMethods.forEach(<span class="hljs-function">(<span class="hljs-params">method</span>)=&gt;</span> {\n        <span class="hljs-keyword">let</span> original = <span class="hljs-built_in">Array</span>.prototype[method];\n        arrayAugmentations[method] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n            <span class="hljs-comment">// &#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x539F;&#x751F;&#x65B9;&#x6CD5;&#x5E76;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</span>\n            <span class="hljs-comment">// do everything you what do !</span>\n            <span class="hljs-keyword">return</span> original.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);\n        };\n    });\n    array.__proto__ = arrayAugmentations;\n}</code></pre><p>&#x3000;&#x3000;&#x56DE;&#x5230;Vue&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x57FA;&#x672C;&#x539F;&#x7406;&#x80AF;&#x5B9A;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x9700;&#x8981;&#x770B;&#x770B;<code>arrayAugmentations</code>&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x4E0B;&#x9762;<code>arrayAugmentations</code>&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x957F;&#x3002;&#x6211;&#x4EEC;&#x4F1A;&#x5728;&#x6CE8;&#x91CA;&#x91CC;&#x9762;&#x89E3;&#x91CA;&#x57FA;&#x672C;&#x539F;&#x7406;:<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// &#x4EE3;&#x7801;&#x6765;&#x81EA;&#x4E8E;array-augmentations.js\nvar _ = require(&apos;../util&apos;)\nvar arrayAugmentations = Object.create(Array.prototype)\n// &#x8FD9;&#x8FB9;&#x64CD;&#x4F5C;&#x548C;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x975E;&#x5E38;&#x76F8;&#x4F3C;\n// &#x521B;&#x5EFA;arrayAugmentations&#x539F;&#x578B;&#x7EE7;&#x627F;`Array.prototype`&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x6570;&#x7EC4;&#x7684;&#x539F;&#x751F;&#x65B9;&#x6CD5;\n// &#x7136;&#x540E;&#x901A;&#x8FC7;arrayAugmentations&#x8986;&#x76D6;&#x6570;&#x7EC4;&#x7684;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#xFF0C;&#x57FA;&#x672C;&#x903B;&#x8F91;&#x5927;&#x81F4;&#x76F8;&#x540C;\n[&apos;push&apos;,&apos;pop&apos;,&apos;shift&apos;,&apos;unshift&apos;,&apos;splice&apos;,&apos;sort&apos;,&apos;reverse&apos;].forEach(function (method) {\n  var original = Array.prototype[method]\n  // &#x8986;&#x76D6;arrayAugmentations&#x4E2D;&#x7684;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;\n  _.define(arrayAugmentations, method, function () {\n    \n    var args = _.toArray(arguments)\n    // &#x8FD9;&#x91CC;&#x8C03;&#x7528;&#x4E86;&#x539F;&#x751F;&#x7684;&#x6570;&#x7EC4;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x83B7;&#x5F97;&#x7ED3;&#x679C;\n    var result = original.apply(this, args)\n    var ob = this.$observer\n    var inserted, removed, index\n    // &#x4E0B;&#x9762;switch&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x957F;&#xFF0C;&#x5176;&#x5B9E;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x9488;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x751F;&#x6210;&#xFF1A;\n    // insert removed inserted &#x5177;&#x4F53;&#x7684;&#x542B;&#x4E49;&#x5BF9;&#x7167;&#x4E4B;&#x524D;&#x7684;&#x89E3;&#x91CA;&#xFF0C;&#x4E86;&#x89E3;&#x5373;&#x53EF;\n    switch (method) {\n      case &apos;push&apos;:\n        inserted = args\n        index = this.length - args.length\n        break\n      case &apos;unshift&apos;:\n        inserted = args\n        index = 0\n        break\n      case &apos;pop&apos;:\n        removed = [result]\n        index = this.length\n        break\n      case &apos;shift&apos;:\n        removed = [result]\n        index = 0\n        break\n      case &apos;splice&apos;:\n        inserted = args.slice(2)\n        removed = result\n        index = args[0]\n        break\n    }\n\n    // &#x5982;&#x679C;&#x7ED9;&#x6570;&#x7EC4;&#x4E2D;&#x63D2;&#x5165;&#x65B0;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x8C03;&#x7528;ob.link\n    // link&#x51FD;&#x6570;&#x5176;&#x5B9E;&#x5728;&#x4E0A;&#x9762;&#x7684;_.augment(value, arrayAugmentations)&#x4E4B;&#x540E;&#x4E5F;&#x88AB;&#x8C03;&#x7528;&#x4E86;\n    // &#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x4E0D;&#x7BA1;\n    // &#x6211;&#x4EEC;&#x53EA;&#x8981;&#x77E5;&#x9053;&#x5176;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x5206;&#x522B;&#x5BF9;&#x63D2;&#x5165;&#x7684;&#x6570;&#x636E;&#x6267;&#x884C;&#x54CD;&#x5E94;&#x5316;\n    if (inserted) ob.link(inserted, index)\n    // &#x5176;&#x5B9E;&#x4ECE;link&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x731C;&#x51FA;unlink&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7684;\n    // &#x4E3B;&#x8981;&#x5C31;&#x662F;&#x5BF9;&#x5220;&#x9664;&#x7684;&#x6570;&#x636E;&#x89E3;&#x9664;&#x54CD;&#x5E94;&#x5316;&#xFF0C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x540E;&#x9762;&#x89E3;&#x91CA;\n    if (removed) ob.unlink(removed)\n\n    // updateIndices&#x6211;&#x4EEC;&#x4E5F;&#x5148;&#x4E0D;&#x8BB2;&#x662F;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;\n    // &#x76EE;&#x7684;&#x5C31;&#x662F;&#x66F4;&#x65B0;&#x5B50;&#x5143;&#x7D20;&#x5728;parents&#x7684;key\n    // &#x56E0;&#x4E3A;push&#x548C;pop&#x662F;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x73B0;&#x6709;&#x5143;&#x7D20;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x9700;&#x8981;&#x8C03;&#x7528;\n    // &#x800C;&#x8BF8;&#x5982;splce shift unshift&#x7B49;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x4F1A;&#x6539;&#x53D8;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x503C;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x8C03;&#x7528;\n    if (method !== &apos;push&apos; &amp;&amp; method !== &apos;pop&apos;) {\n      ob.updateIndices()\n    }\n\n    // &#x540C;&#x6837;&#x6211;&#x4EEC;&#x5148;&#x4E0D;&#x8003;&#x8651;propagate&#x5185;&#x90E8;&#x5B9E;&#x73B0;,&#x6211;&#x4EEC;&#x53EA;&#x8981;propagate&#x51FD;&#x6570;&#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;\n    // &#x89E6;&#x53D1;&#x81EA;&#x8EAB;&#x53CA;&#x5176;&#x9012;&#x5F52;&#x89E6;&#x53D1;&#x7236;&#x7EA7;&#x7684;&#x4E8B;&#x4EF6;\n    // &#x5982;&#x679C;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x6709;&#x63D2;&#x5165;&#x6216;&#x8005;&#x5220;&#x9664;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x5BF9;&#x5916;&#x89E6;&#x53D1;&quot;length&quot;&#x88AB;&#x6539;&#x53D8;\n    if (inserted || removed) {\n      ob.propagate(&apos;set&apos;, &apos;length&apos;, this.length)\n    }\n\n    // &#x5BF9;&#x5916;&#x89E6;&#x53D1;mutate&#x4E8B;&#x4EF6;\n    // &#x53EF;&#x4EE5;&#x5BF9;&#x7167;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8BB2;&#x7684;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&apos;array push&apos;&#xFF0C;&#x5C31;&#x662F;&#x5728;&#x8FD9;&#x91CC;&#x89E6;&#x53D1;&#x7684;&#xFF0C;&#x56DE;&#x5934;&#x770B;&#x770B;&#x5427;\n    ob.propagate(&apos;mutate&apos;, &apos;&apos;, this, {\n      method   : method,\n      args     : args,\n      result   : result,\n      index    : index,\n      inserted : inserted || [],\n      removed  : removed || []\n    })\n\n    return result\n  })\n})\n\n// &#x53EF;&#x4EE5;&#x56DE;&#x770B;&#x4E00;&#x4E0B;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B; array set&#xFF0C;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x8BBE;&#x7F6E;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x7684;&#x503C;\n// &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x4E86;splice&#x53D8;&#x5F02;&#x65B9;&#x6CD5;, &#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5728;Vue&#x4E2D;&#x56FD;&#x60F3;&#x8981;&#x6539;&#x53D8;&#x67D0;&#x4E2A;&#x4E0B;&#x6807;&#x7684;&#x503C;&#x7684;&#x65F6;&#x5019;\n// &#x5B98;&#x7F51;&#x7ED9;&#x51FA;&#x7684;&#x5EFA;&#x8BAE;&#x65E0;&#x975E;&#x662F;Vue.set&#x6216;&#x8005;&#x5C31;&#x662F;splice&#xFF0C;&#x90FD;&#x662F;&#x76F8;&#x540C;&#x7684;&#x539F;&#x7406;\n// &#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;&#x4EE3;&#x7801;&#x5FFD;&#x7565;&#x4E86;&#x8D85;&#x51FA;&#x4E0B;&#x6807;&#x8303;&#x56F4;&#x7684;&#x503C;\n_.define(arrayAugmentations, &apos;$set&apos;, function (index, val) {\n  if (index &gt;= this.length) {\n    this.length = index + 1\n  }\n  return this.splice(index, 1, val)[0]\n})\n// $remove&#x4E0E;$add&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x9053;&#x7406;&#xFF0C;&#x90FD;&#x662F;&#x8C03;&#x7528;&#x7684;&#x662F;`splice`&#x51FD;&#x6570;\n_.define(arrayAugmentations, &apos;$remove&apos;, function (index) {\n  if (typeof index !== &apos;number&apos;) {\n    index = this.indexOf(index)\n  }\n  if (index &gt; -1) {\n    return this.splice(index, 1)[0]\n  }\n})\n\nmodule.exports = arrayAugmentations" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">// &#x4EE3;&#x7801;&#x6765;&#x81EA;&#x4E8E;array-augmentations.js</span>\n<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;../util&apos;</span>)\n<span class="hljs-keyword">var</span> arrayAugmentations = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Array</span>.prototype)\n<span class="hljs-comment">// &#x8FD9;&#x8FB9;&#x64CD;&#x4F5C;&#x548C;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x975E;&#x5E38;&#x76F8;&#x4F3C;</span>\n<span class="hljs-comment">// &#x521B;&#x5EFA;arrayAugmentations&#x539F;&#x578B;&#x7EE7;&#x627F;`Array.prototype`&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x6570;&#x7EC4;&#x7684;&#x539F;&#x751F;&#x65B9;&#x6CD5;</span>\n<span class="hljs-comment">// &#x7136;&#x540E;&#x901A;&#x8FC7;arrayAugmentations&#x8986;&#x76D6;&#x6570;&#x7EC4;&#x7684;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#xFF0C;&#x57FA;&#x672C;&#x903B;&#x8F91;&#x5927;&#x81F4;&#x76F8;&#x540C;</span>\n[<span class="hljs-string">&apos;push&apos;</span>,<span class="hljs-string">&apos;pop&apos;</span>,<span class="hljs-string">&apos;shift&apos;</span>,<span class="hljs-string">&apos;unshift&apos;</span>,<span class="hljs-string">&apos;splice&apos;</span>,<span class="hljs-string">&apos;sort&apos;</span>,<span class="hljs-string">&apos;reverse&apos;</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{\n  <span class="hljs-keyword">var</span> original = <span class="hljs-built_in">Array</span>.prototype[method]\n  <span class="hljs-comment">// &#x8986;&#x76D6;arrayAugmentations&#x4E2D;&#x7684;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;</span>\n  _.define(arrayAugmentations, method, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n    \n    <span class="hljs-keyword">var</span> args = _.toArray(<span class="hljs-built_in">arguments</span>)\n    <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x8C03;&#x7528;&#x4E86;&#x539F;&#x751F;&#x7684;&#x6570;&#x7EC4;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x83B7;&#x5F97;&#x7ED3;&#x679C;</span>\n    <span class="hljs-keyword">var</span> result = original.apply(<span class="hljs-keyword">this</span>, args)\n    <span class="hljs-keyword">var</span> ob = <span class="hljs-keyword">this</span>.$observer\n    <span class="hljs-keyword">var</span> inserted, removed, index\n    <span class="hljs-comment">// &#x4E0B;&#x9762;switch&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x957F;&#xFF0C;&#x5176;&#x5B9E;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x9488;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x751F;&#x6210;&#xFF1A;</span>\n    <span class="hljs-comment">// insert removed inserted &#x5177;&#x4F53;&#x7684;&#x542B;&#x4E49;&#x5BF9;&#x7167;&#x4E4B;&#x524D;&#x7684;&#x89E3;&#x91CA;&#xFF0C;&#x4E86;&#x89E3;&#x5373;&#x53EF;</span>\n    <span class="hljs-keyword">switch</span> (method) {\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;push&apos;</span>:\n        inserted = args\n        index = <span class="hljs-keyword">this</span>.length - args.length\n        <span class="hljs-keyword">break</span>\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;unshift&apos;</span>:\n        inserted = args\n        index = <span class="hljs-number">0</span>\n        <span class="hljs-keyword">break</span>\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;pop&apos;</span>:\n        removed = [result]\n        index = <span class="hljs-keyword">this</span>.length\n        <span class="hljs-keyword">break</span>\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;shift&apos;</span>:\n        removed = [result]\n        index = <span class="hljs-number">0</span>\n        <span class="hljs-keyword">break</span>\n      <span class="hljs-keyword">case</span> <span class="hljs-string">&apos;splice&apos;</span>:\n        inserted = args.slice(<span class="hljs-number">2</span>)\n        removed = result\n        index = args[<span class="hljs-number">0</span>]\n        <span class="hljs-keyword">break</span>\n    }\n\n    <span class="hljs-comment">// &#x5982;&#x679C;&#x7ED9;&#x6570;&#x7EC4;&#x4E2D;&#x63D2;&#x5165;&#x65B0;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x8C03;&#x7528;ob.link</span>\n    <span class="hljs-comment">// link&#x51FD;&#x6570;&#x5176;&#x5B9E;&#x5728;&#x4E0A;&#x9762;&#x7684;_.augment(value, arrayAugmentations)&#x4E4B;&#x540E;&#x4E5F;&#x88AB;&#x8C03;&#x7528;&#x4E86;</span>\n    <span class="hljs-comment">// &#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x4E0D;&#x7BA1;</span>\n    <span class="hljs-comment">// &#x6211;&#x4EEC;&#x53EA;&#x8981;&#x77E5;&#x9053;&#x5176;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x5206;&#x522B;&#x5BF9;&#x63D2;&#x5165;&#x7684;&#x6570;&#x636E;&#x6267;&#x884C;&#x54CD;&#x5E94;&#x5316;</span>\n    <span class="hljs-keyword">if</span> (inserted) ob.link(inserted, index)\n    <span class="hljs-comment">// &#x5176;&#x5B9E;&#x4ECE;link&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x731C;&#x51FA;unlink&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7684;</span>\n    <span class="hljs-comment">// &#x4E3B;&#x8981;&#x5C31;&#x662F;&#x5BF9;&#x5220;&#x9664;&#x7684;&#x6570;&#x636E;&#x89E3;&#x9664;&#x54CD;&#x5E94;&#x5316;&#xFF0C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x540E;&#x9762;&#x89E3;&#x91CA;</span>\n    <span class="hljs-keyword">if</span> (removed) ob.unlink(removed)\n\n    <span class="hljs-comment">// updateIndices&#x6211;&#x4EEC;&#x4E5F;&#x5148;&#x4E0D;&#x8BB2;&#x662F;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;</span>\n    <span class="hljs-comment">// &#x76EE;&#x7684;&#x5C31;&#x662F;&#x66F4;&#x65B0;&#x5B50;&#x5143;&#x7D20;&#x5728;parents&#x7684;key</span>\n    <span class="hljs-comment">// &#x56E0;&#x4E3A;push&#x548C;pop&#x662F;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x73B0;&#x6709;&#x5143;&#x7D20;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x9700;&#x8981;&#x8C03;&#x7528;</span>\n    <span class="hljs-comment">// &#x800C;&#x8BF8;&#x5982;splce shift unshift&#x7B49;&#x53D8;&#x5F02;&#x65B9;&#x6CD5;&#x4F1A;&#x6539;&#x53D8;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x503C;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x8C03;&#x7528;</span>\n    <span class="hljs-keyword">if</span> (method !== <span class="hljs-string">&apos;push&apos;</span> &amp;&amp; method !== <span class="hljs-string">&apos;pop&apos;</span>) {\n      ob.updateIndices()\n    }\n\n    <span class="hljs-comment">// &#x540C;&#x6837;&#x6211;&#x4EEC;&#x5148;&#x4E0D;&#x8003;&#x8651;propagate&#x5185;&#x90E8;&#x5B9E;&#x73B0;,&#x6211;&#x4EEC;&#x53EA;&#x8981;propagate&#x51FD;&#x6570;&#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;</span>\n    <span class="hljs-comment">// &#x89E6;&#x53D1;&#x81EA;&#x8EAB;&#x53CA;&#x5176;&#x9012;&#x5F52;&#x89E6;&#x53D1;&#x7236;&#x7EA7;&#x7684;&#x4E8B;&#x4EF6;</span>\n    <span class="hljs-comment">// &#x5982;&#x679C;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x6709;&#x63D2;&#x5165;&#x6216;&#x8005;&#x5220;&#x9664;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x5BF9;&#x5916;&#x89E6;&#x53D1;&quot;length&quot;&#x88AB;&#x6539;&#x53D8;</span>\n    <span class="hljs-keyword">if</span> (inserted || removed) {\n      ob.propagate(<span class="hljs-string">&apos;set&apos;</span>, <span class="hljs-string">&apos;length&apos;</span>, <span class="hljs-keyword">this</span>.length)\n    }\n\n    <span class="hljs-comment">// &#x5BF9;&#x5916;&#x89E6;&#x53D1;mutate&#x4E8B;&#x4EF6;</span>\n    <span class="hljs-comment">// &#x53EF;&#x4EE5;&#x5BF9;&#x7167;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8BB2;&#x7684;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&apos;array push&apos;&#xFF0C;&#x5C31;&#x662F;&#x5728;&#x8FD9;&#x91CC;&#x89E6;&#x53D1;&#x7684;&#xFF0C;&#x56DE;&#x5934;&#x770B;&#x770B;&#x5427;</span>\n    ob.propagate(<span class="hljs-string">&apos;mutate&apos;</span>, <span class="hljs-string">&apos;&apos;</span>, <span class="hljs-keyword">this</span>, {\n      <span class="hljs-attr">method</span>   : method,\n      <span class="hljs-attr">args</span>     : args,\n      <span class="hljs-attr">result</span>   : result,\n      <span class="hljs-attr">index</span>    : index,\n      <span class="hljs-attr">inserted</span> : inserted || [],\n      <span class="hljs-attr">removed</span>  : removed || []\n    })\n\n    <span class="hljs-keyword">return</span> result\n  })\n})\n\n<span class="hljs-comment">// &#x53EF;&#x4EE5;&#x56DE;&#x770B;&#x4E00;&#x4E0B;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B; array set&#xFF0C;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x8BBE;&#x7F6E;&#x5BF9;&#x5E94;&#x4E0B;&#x6807;&#x7684;&#x503C;</span>\n<span class="hljs-comment">// &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x4E86;splice&#x53D8;&#x5F02;&#x65B9;&#x6CD5;, &#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5728;Vue&#x4E2D;&#x56FD;&#x60F3;&#x8981;&#x6539;&#x53D8;&#x67D0;&#x4E2A;&#x4E0B;&#x6807;&#x7684;&#x503C;&#x7684;&#x65F6;&#x5019;</span>\n<span class="hljs-comment">// &#x5B98;&#x7F51;&#x7ED9;&#x51FA;&#x7684;&#x5EFA;&#x8BAE;&#x65E0;&#x975E;&#x662F;Vue.set&#x6216;&#x8005;&#x5C31;&#x662F;splice&#xFF0C;&#x90FD;&#x662F;&#x76F8;&#x540C;&#x7684;&#x539F;&#x7406;</span>\n<span class="hljs-comment">// &#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;&#x4EE3;&#x7801;&#x5FFD;&#x7565;&#x4E86;&#x8D85;&#x51FA;&#x4E0B;&#x6807;&#x8303;&#x56F4;&#x7684;&#x503C;</span>\n_.define(arrayAugmentations, <span class="hljs-string">&apos;$set&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index, val</span>) </span>{\n  <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-keyword">this</span>.length) {\n    <span class="hljs-keyword">this</span>.length = index + <span class="hljs-number">1</span>\n  }\n  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.splice(index, <span class="hljs-number">1</span>, val)[<span class="hljs-number">0</span>]\n})\n<span class="hljs-comment">// $remove&#x4E0E;$add&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x9053;&#x7406;&#xFF0C;&#x90FD;&#x662F;&#x8C03;&#x7528;&#x7684;&#x662F;`splice`&#x51FD;&#x6570;</span>\n_.define(arrayAugmentations, <span class="hljs-string">&apos;$remove&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{\n  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> index !== <span class="hljs-string">&apos;number&apos;</span>) {\n    index = <span class="hljs-keyword">this</span>.indexOf(index)\n  }\n  <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">-1</span>) {\n    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.splice(index, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]\n  }\n})\n\n<span class="hljs-built_in">module</span>.exports = arrayAugmentations</code></pre><p>&#x3000;&#x3000;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x957F;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x89E3;&#x91CA;&#x6211;&#x4EEC;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5DF2;&#x7ECF;&#x6CE8;&#x91CA;&#x3002;&#x5230;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x5B8C;<code>arrayAugmentations</code>&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x770B;&#x770B;<code>_.augment</code>&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x6587;&#x7AE0;<a href="https://github.com/MrErHu/blog/issues/29" rel="nofollow noreferrer" target="_blank">&#x4ECE;Vue&#x6570;&#x7EC4;&#x54CD;&#x5E94;&#x5316;&#x6240;&#x5F15;&#x53D1;&#x7684;&#x601D;&#x8003;</a>&#x4E2D;&#x8BB2;&#x8FC7;Vue&#x662F;&#x901A;&#x8FC7;<code>__proto__</code>&#x6765;&#x5B9E;&#x73B0;&#x6570;&#x7EC4;&#x54CD;&#x5E94;&#x5316;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;<code>__proto__</code>&#x662F;&#x4E2A;&#x975E;&#x6807;&#x51C6;&#x5C5E;&#x6027;&#xFF0C;&#x867D;&#x7136;&#x5E7F;&#x6CDB;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x5382;&#x5546;&#x57FA;&#x672C;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x662F;&#x5B58;&#x5728;&#x90E8;&#x5206;&#x7684;&#x5B89;&#x5353;&#x7248;&#x672C;&#x5E76;&#x4E0D;&#x652F;&#x6301;&#x8BE5;&#x5C5E;&#x6027;&#xFF0C;Vue&#x5FC5;&#x987B;&#x5BF9;&#x6B64;&#x505A;&#x76F8;&#x5173;&#x7684;&#x5904;&#x7406;&#xFF0C;<code>_.augment</code>&#x5C31;&#x8D1F;&#x8D23;&#x8FD9;&#x4E2A;&#x90E8;&#x5206;:<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="exports.augment = &apos;__proto__&apos; in {}\n  ? function (target, proto) {\n      target.__proto__ = proto\n    }\n  : exports.deepMixin\n  \nexports.deepMixin = function (to, from) {\n  Object.getOwnPropertyNames(from).forEach(function (key) {\n    var desc =Object.getOwnPropertyDescriptor(from, key)\n    Object.defineProperty(to, key, desc)\n  })\n}  " title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript">exports.augment = <span class="hljs-string">&apos;__proto__&apos;</span> <span class="hljs-keyword">in</span> {}\n  ? <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">target, proto</span>) </span>{\n      target.__proto__ = proto\n    }\n  : exports.deepMixin\n  \nexports.deepMixin = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">to, from</span>) </span>{\n  <span class="hljs-built_in">Object</span>.getOwnPropertyNames(<span class="hljs-keyword">from</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{\n    <span class="hljs-keyword">var</span> desc =<span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(<span class="hljs-keyword">from</span>, key)\n    <span class="hljs-built_in">Object</span>.defineProperty(to, key, desc)\n  })\n}  </code></pre><p>&#x3000;&#x3000;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x5982;&#x679C;&#x6D4F;&#x89C8;&#x5668;&#x4E0D;&#x652F;&#x6301;<code>__proto__</code>&#x8BDD;&#x8C03;&#x7528;<code>deepMixin</code>&#x51FD;&#x6570;&#x3002;&#x800C;<code>deepMixin</code>&#x7684;&#x5B9E;&#x73B0;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x7684;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x4F7F;&#x7528;<code>Object.defineProperty</code>&#x5C06;&#x539F;&#x5BF9;&#x8C61;&#x7684;<strong>&#x5C5E;&#x6027;&#x63CF;&#x8FF0;&#x7B26;</strong>&#x8D4B;&#x503C;&#x7ED9;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x3002;&#x63A5;&#x7740;&#x8C03;&#x7528;&#x4E86;&#x51FD;&#x6570;&#xFF1A;<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="this.link(value)" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript" style="word-break:break-word;white-space:initial"><span class="hljs-keyword">this</span>.link(value)</code></pre><p>&#x3000;&#x3000;&#x5173;&#x4E8E;<code>link</code>&#x51FD;&#x6570;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x5907;&#x6CE8;&#x4E2D;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x89C1;&#x8FC7;&#x4E86;:</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="if (inserted) ob.link(inserted, index)" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript" style="word-break:break-word;white-space:initial"><span class="hljs-keyword">if</span> (inserted) ob.link(inserted, index)</code></pre><p>&#x3000;&#x3000;&#x5F53;&#x65F6;&#x6211;&#x4EEC;&#x7684;&#x89E3;&#x91CA;&#x662F;&#x5C06;&#x65B0;&#x63D2;&#x5165;&#x7684;&#x6570;&#x636E;&#x54CD;&#x5E94;&#x5316;&#xFF0C;&#x77E5;&#x9053;&#x4E86;&#x529F;&#x80FD;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x4EE3;&#x7801;&#x7684;&#x5B9E;&#x73B0;:<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="// p === Observer.prototype\np.link = function (items, index) {\n  index = index || 0\n  for (var i = 0, l = items.length; i &lt; l; i++) {\n    this.observe(i + index, items[i])\n  }\n}\n\np.observe = function (key, val) {\n  var ob = Observer.create(val)\n  if (ob) {\n    // register self as a parent of the child observer.\n    var parents = ob.parents\n    if (!parents) {\n      ob.parents = parents = Object.create(null)\n    }\n    if (parents[this.id]) {\n      _.warn(&apos;Observing duplicate key: &apos; + key)\n      return\n    }\n    parents[this.id] = {\n      ob: this,\n      key: key\n    }\n  }\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-comment">// p === Observer.prototype</span>\np.link = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items, index</span>) </span>{\n  index = index || <span class="hljs-number">0</span>\n  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = items.length; i &lt; l; i++) {\n    <span class="hljs-keyword">this</span>.observe(i + index, items[i])\n  }\n}\n\np.observe = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, val</span>) </span>{\n  <span class="hljs-keyword">var</span> ob = Observer.create(val)\n  <span class="hljs-keyword">if</span> (ob) {\n    <span class="hljs-comment">// register self as a parent of the child observer.</span>\n    <span class="hljs-keyword">var</span> parents = ob.parents\n    <span class="hljs-keyword">if</span> (!parents) {\n      ob.parents = parents = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>)\n    }\n    <span class="hljs-keyword">if</span> (parents[<span class="hljs-keyword">this</span>.id]) {\n      _.warn(<span class="hljs-string">&apos;Observing duplicate key: &apos;</span> + key)\n      <span class="hljs-keyword">return</span>\n    }\n    parents[<span class="hljs-keyword">this</span>.id] = {\n      <span class="hljs-attr">ob</span>: <span class="hljs-keyword">this</span>,\n      <span class="hljs-attr">key</span>: key\n    }\n  }\n}</code></pre><p>&#x3000;&#x3000;&#x5176;&#x5B9E;&#x4EE3;&#x7801;&#x903B;&#x8F91;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;<code>link</code>&#x51FD;&#x6570;&#x4F1A;&#x5BF9;&#x7ED9;&#x5B9A;&#x6570;&#x7EC4;index(&#x9ED8;&#x8BA4;&#x4E3A;0)&#x4E4B;&#x540E;&#x7684;&#x5143;&#x7D20;&#x8C03;&#x7528;<code>this.observe</code>, &#x800C;<code>observe</code>&#x5176;&#x5B9E;&#x4E5F;&#x5C31;&#x662F;&#x5BF9;&#x7ED9;&#x5B9A;&#x7684;<code>val</code>&#x503C;&#x9012;&#x5F52;&#x8C03;&#x7528;<code>Observer.create</code>,&#x5C06;&#x6570;&#x636E;&#x54CD;&#x5E94;&#x5316;&#xFF0C;&#x5E76;&#x5EFA;&#x7ACB;&#x7236;&#x7EA7;&#x7684;Observer&#x4E0E;&#x5F53;&#x524D;&#x5B9E;&#x4F8B;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x3002;&#x524D;&#x9762;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x53D1;&#x73B0;Vue&#x4E0D;&#x4EC5;&#x4EC5;&#x4F1A;&#x5BF9;&#x63D2;&#x5165;&#x7684;&#x6570;&#x636E;&#x54CD;&#x5E94;&#x5316;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x4F1A;&#x5BF9;&#x5220;&#x9664;&#x7684;&#x5143;&#x7D20;&#x8C03;&#x7528;<code>unlink</code>,&#x5177;&#x4F53;&#x7684;&#x8C03;&#x7528;&#x4EE3;&#x7801;&#x662F;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="if (removed) ob.unlink(removed)" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript" style="word-break:break-word;white-space:initial"><span class="hljs-keyword">if</span> (removed) ob.unlink(removed)</code></pre><p>&#x3000;&#x3000;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5927;&#x81F4;&#x8BB2;&#x8FC7;&#x5176;&#x7528;&#x4F5C;&#x5C31;&#x662F;&#x5BF9;&#x5220;&#x9664;&#x7684;&#x6570;&#x636E;&#x89E3;&#x9664;&#x54CD;&#x5E94;&#x5316;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="p.unlink = function (items) {\n  for (var i = 0, l = items.length; i &lt; l; i++) {\n    this.unobserve(items[i])\n  }\n}\np.unobserve = function (val) {\n  if (val &amp;&amp; val.$observer) {\n    val.$observer.parents[this.id] = null\n  }\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript">p.unlink = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{\n  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = items.length; i &lt; l; i++) {\n    <span class="hljs-keyword">this</span>.unobserve(items[i])\n  }\n}\np.unobserve = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{\n  <span class="hljs-keyword">if</span> (val &amp;&amp; val.$observer) {\n    val.$observer.parents[<span class="hljs-keyword">this</span>.id] = <span class="hljs-literal">null</span>\n  }\n}</code></pre><p>&#x3000;&#x3000;&#x4EE3;&#x7801;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x5BF9;&#x6570;&#x636E;&#x8C03;&#x7528;<code>unobserve</code>&#xFF0C;&#x800C;<code>unobserve</code>&#x51FD;&#x6570;&#x7684;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x89E3;&#x9664;&#x7236;&#x7EA7;<code>observer</code>&#x4E0E;&#x5F53;&#x524D;&#x6570;&#x636E;&#x7684;&#x5173;&#x7CFB;&#x5E76;&#x4E14;&#x4E0D;&#x518D;&#x4FDD;&#x7559;&#x5F15;&#x7528;&#xFF0C;&#x8BA9;&#x6D4F;&#x89C8;&#x5668;&#x5185;&#x6838;&#x5FC5;&#x8981;&#x7684;&#x65F6;&#x5019;&#x80FD;&#x591F;&#x56DE;&#x6536;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x3002;</p><p>&#x3000;&#x3000;&#x5728;<code>arrayAugmentations</code>&#x4E2D;&#x5176;&#x5B9E;&#x8FD8;&#x8C03;&#x7528;&#x8FC7;<code>Observer</code>&#x7684;&#x4E24;&#x4E2A;&#x539F;&#x578B;&#x65B9;&#x6CD5;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="ob.updateIndices()" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript" style="word-break:break-word;white-space:initial">ob.updateIndices()</code></pre><p>&#x3000;&#x3000;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="ob.propagate(&apos;set&apos;, &apos;length&apos;, this.length)" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript" style="word-break:break-word;white-space:initial">ob.propagate(<span class="hljs-string">&apos;set&apos;</span>, <span class="hljs-string">&apos;length&apos;</span>, <span class="hljs-keyword">this</span>.length)</code></pre><p>&#x3000;&#x3000;&#x9996;&#x5148;&#x770B;&#x770B;<code>updateIndices</code>&#x51FD;&#x6570;&#xFF0C;&#x5F53;&#x65F6;&#x7684;&#x51FD;&#x6570;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x66F4;&#x65B0;&#x5B50;&#x5143;&#x7D20;&#x5728;parents&#x7684;key&#xFF0C;&#x6765;&#x770B;&#x770B;&#x5177;&#x4F53;&#x5B9E;&#x73B0;:<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="p.updateIndices = function () {\n  var arr = this.value\n  var i = arr.length\n  var ob\n  while (i--) {\n    ob = arr[i] &amp;&amp; arr[i].$observer\n    if (ob) {\n      ob.parents[this.id].key = i\n    }\n  }\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript">p.updateIndices = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n  <span class="hljs-keyword">var</span> arr = <span class="hljs-keyword">this</span>.value\n  <span class="hljs-keyword">var</span> i = arr.length\n  <span class="hljs-keyword">var</span> ob\n  <span class="hljs-keyword">while</span> (i--) {\n    ob = arr[i] &amp;&amp; arr[i].$observer\n    <span class="hljs-keyword">if</span> (ob) {\n      ob.parents[<span class="hljs-keyword">this</span>.id].key = i\n    }\n  }\n}</code></pre><p>&#x3000;&#x3000;&#x63A5;&#x7740;&#x770B;&#x51FD;&#x6570;<code>propagate</code>:<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="p.propagate = function (event, path, val, mutation) {\n  this.emit(event, path, val, mutation)\n  if (!this.parents) return\n  for (var id in this.parents) {\n    var parent = this.parents[id]\n    if (!parent) continue\n    var key = parent.key\n    var parentPath = path\n      ? key + Observer.pathDelimiter + path\n      : key\n    parent.ob.propagate(event, parentPath, val, mutation)\n  }\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript">p.propagate = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event, path, val, mutation</span>) </span>{\n  <span class="hljs-keyword">this</span>.emit(event, path, val, mutation)\n  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.parents) <span class="hljs-keyword">return</span>\n  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> id <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.parents) {\n    <span class="hljs-keyword">var</span> parent = <span class="hljs-keyword">this</span>.parents[id]\n    <span class="hljs-keyword">if</span> (!parent) <span class="hljs-keyword">continue</span>\n    <span class="hljs-keyword">var</span> key = parent.key\n    <span class="hljs-keyword">var</span> parentPath = path\n      ? key + Observer.pathDelimiter + path\n      : key\n    parent.ob.propagate(event, parentPath, val, mutation)\n  }\n}</code></pre><p>&#x3000;&#x3000;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8BF4;&#x8FC7;<code>propagate</code>&#x51FD;&#x6570;&#x7684;&#x4F5C;&#x7528;&#x7684;&#x5C31;&#x662F;&#x89E6;&#x53D1;&#x81EA;&#x8EAB;&#x53CA;&#x5176;&#x9012;&#x5F52;&#x89E6;&#x53D1;&#x7236;&#x7EA7;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x9996;&#x5148;&#x8C03;&#x7528;<code>emit</code>&#x51FD;&#x6570;&#x5BF9;&#x5916;&#x89E6;&#x53D1;&#x65F6;&#x95F4;&#xFF0C;&#x5176;&#x53C2;&#x6570;&#x5206;&#x522B;&#x662F;&#xFF1A;&#x4E8B;&#x4EF6;&#x540D;&#x3001;&#x8DEF;&#x5F84;&#x3001;&#x503C;&#x3001;<code>mutatin</code>&#x5BF9;&#x8C61;&#x3002;&#x7136;&#x540E;&#x63A5;&#x7740;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x7236;&#x7EA7;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x5BF9;&#x5E94;&#x6539;&#x53D8;&#x89E6;&#x53D1;&#x7684;<code>path</code>&#x53C2;&#x6570;&#x3002;<code>parentPath</code>&#x7B49;&#x4E8E;<code>parents[id].key</code> + <code>Observer.pathDelimiter</code> + <code>path</code></p><p>&#x3000;&#x3000;&#x5230;&#x6B64;&#x4E3A;&#x6B62;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x5B66;&#x4E60;&#x5B8C;&#x4E86;Vue&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x6570;&#x7EC4;&#x7684;&#x54CD;&#x5E94;&#x5316;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x9700;&#x8981;&#x6765;&#x770B;&#x770B;&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5BF9;&#x8C61;&#x7684;&#x54CD;&#x5E94;&#x5316;&#x7684;&#x3002;<br>&#x3000;&#x3000;</p><h4>&#x5BF9;&#x8C61;&#x3000;&#x3000;</h4><p>&#x3000;&#x3000;<br>&#x3000;&#x3000;&#x5728;<code>Observer</code>&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x5173;&#x4E8E;&#x5BF9;&#x8C61;&#x5904;&#x7406;&#x7684;&#x4EE3;&#x7801;&#x662F;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="if (type === OBJECT) {\n    if (options &amp;&amp; options.doNotAlterProto) {\n        _.deepMixin(value, objectAugmentations)\n    } else {\n        _.augment(value, objectAugmentations)\n    }\n    this.walk(value)\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-keyword">if</span> (type === OBJECT) {\n    <span class="hljs-keyword">if</span> (options &amp;&amp; options.doNotAlterProto) {\n        _.deepMixin(value, objectAugmentations)\n    } <span class="hljs-keyword">else</span> {\n        _.augment(value, objectAugmentations)\n    }\n    <span class="hljs-keyword">this</span>.walk(value)\n}</code></pre><p>&#x3000;&#x3000;&#x548C;&#x6570;&#x7EC4;&#x4E00;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x8981;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;<code>objectAugmentations</code>&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#xFF1A;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="var _ = require(&apos;../util&apos;)\nvar objectAgumentations = Object.create(Object.prototype)\n\n_.define(objectAgumentations, &apos;$add&apos;, function (key, val) {\n  if (this.hasOwnProperty(key)) return\n  _.define(this, key, val, true)\n  var ob = this.$observer\n  ob.observe(key, val)\n  ob.convert(key, val)\n  ob.emit(&apos;add:self&apos;, key, val)\n  ob.propagate(&apos;add&apos;, key, val)\n})\n\n_.define(objectAgumentations, &apos;$delete&apos;, function (key) {\n  if (!this.hasOwnProperty(key)) return\n  delete this[key]\n  var ob = this.$observer\n  ob.emit(&apos;delete:self&apos;, key)\n  ob.propagate(&apos;delete&apos;, key)\n})" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript"><span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;../util&apos;</span>)\n<span class="hljs-keyword">var</span> objectAgumentations = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype)\n\n_.define(objectAgumentations, <span class="hljs-string">&apos;$add&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, val</span>) </span>{\n  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hasOwnProperty(key)) <span class="hljs-keyword">return</span>\n  _.define(<span class="hljs-keyword">this</span>, key, val, <span class="hljs-literal">true</span>)\n  <span class="hljs-keyword">var</span> ob = <span class="hljs-keyword">this</span>.$observer\n  ob.observe(key, val)\n  ob.convert(key, val)\n  ob.emit(<span class="hljs-string">&apos;add:self&apos;</span>, key, val)\n  ob.propagate(<span class="hljs-string">&apos;add&apos;</span>, key, val)\n})\n\n_.define(objectAgumentations, <span class="hljs-string">&apos;$delete&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{\n  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.hasOwnProperty(key)) <span class="hljs-keyword">return</span>\n  <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>[key]\n  <span class="hljs-keyword">var</span> ob = <span class="hljs-keyword">this</span>.$observer\n  ob.emit(<span class="hljs-string">&apos;delete:self&apos;</span>, key)\n  ob.propagate(<span class="hljs-string">&apos;delete&apos;</span>, key)\n})</code></pre><p>&#x3000;&#x3000;&#x76F8;&#x6BD4;&#x4E8E;<code>arrayAugmentations</code>&#xFF0C;<code>objectAgumentations</code>&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x5219;&#x7B80;&#x5355;&#x7684;&#x591A;&#xFF0C;<code>objectAgumentations</code>&#x6DFB;&#x52A0;&#x4E86;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;: <code>$add</code>&#x4E0E;<code>$delete</code>&#x3002;</p><p>&#x3000;&#x3000;<code>$add</code>&#x7528;&#x4E8E;&#x7ED9;&#x5BF9;&#x8C61;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x5BF9;&#x8C61;&#x4E4B;&#x524D;&#x5C31;&#x5B58;&#x5728;&#x952E;&#x503C;&#x4E3A;<code>key</code>&#x7684;&#x5C5E;&#x6027;&#x5219;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#xFF0C;&#x5426;&#x5219;&#x9996;&#x5148;&#x4F7F;&#x7528;<code>_.define</code>&#x8D4B;&#x503C;&#x8BE5;&#x5C5E;&#x6027;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;<code>ob.observe</code>&#x76EE;&#x7684;&#x662F;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x4F7F;&#x5F97;<code>val</code>&#x503C;&#x54CD;&#x5E94;&#x5316;&#x3002;&#x800C;<code>convert</code>&#x51FD;&#x6570;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5C06;&#x8BE5;&#x5C5E;&#x6027;&#x8F6C;&#x6362;&#x6210;&#x8BBF;&#x95EE;&#x5668;&#x5C5E;&#x6027;<code>getter/setter</code>&#x4F7F;&#x5F97;&#x5C5E;&#x6027;&#x88AB;&#x8BBF;&#x95EE;&#x6216;&#x8005;&#x88AB;&#x6539;&#x53D8;&#x7684;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x76D1;&#x542C;&#x5230;&#xFF0C;&#x5177;&#x4F53;&#x6211;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;<code>convert</code>&#x51FD;&#x6570;&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#xFF1A;<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="p.convert = function (key, val) {\n  var ob = this\n  Object.defineProperty(ob.value, key, {\n    enumerable: true,\n    configurable: true,\n    get: function () {\n      if (Observer.emitGet) {\n        ob.propagate(&apos;get&apos;, key)\n      }\n      return val\n    },\n    set: function (newVal) {\n      if (newVal === val) return\n      ob.unobserve(val)\n      val = newVal\n      ob.observe(key, newVal)\n      ob.emit(&apos;set:self&apos;, key, newVal)\n      ob.propagate(&apos;set&apos;, key, newVal)\n    }\n  })\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript">p.convert = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, val</span>) </span>{\n  <span class="hljs-keyword">var</span> ob = <span class="hljs-keyword">this</span>\n  <span class="hljs-built_in">Object</span>.defineProperty(ob.value, key, {\n    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,\n    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n      <span class="hljs-keyword">if</span> (Observer.emitGet) {\n        ob.propagate(<span class="hljs-string">&apos;get&apos;</span>, key)\n      }\n      <span class="hljs-keyword">return</span> val\n    },\n    <span class="hljs-attr">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">newVal</span>) </span>{\n      <span class="hljs-keyword">if</span> (newVal === val) <span class="hljs-keyword">return</span>\n      ob.unobserve(val)\n      val = newVal\n      ob.observe(key, newVal)\n      ob.emit(<span class="hljs-string">&apos;set:self&apos;</span>, key, newVal)\n      ob.propagate(<span class="hljs-string">&apos;set&apos;</span>, key, newVal)\n    }\n  })\n}</code></pre><p>&#x3000;&#x3000;<code>convert</code>&#x51FD;&#x6570;&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x4E5F;&#x4E0D;&#x590D;&#x6742;&#xFF0C;&#x5728;<code>get</code>&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x5F00;&#x542F;&#x4E86;&#x5168;&#x5C40;&#x7684;<code>Observer.emitGet</code>&#x5F00;&#x5173;&#xFF0C;&#x5728;&#x8BE5;&#x5C5E;&#x6027;&#x88AB;&#x8BBF;&#x95EE;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5BF9;&#x8C03;&#x7528;<code>propagate</code>&#x89E6;&#x53D1;&#x672C;&#x8EAB;&#x4EE5;&#x53CA;&#x7236;&#x7EA7;&#x7684;&#x5BF9;&#x5E94;<code>get</code>&#x4E8B;&#x4EF6;&#x3002;&#x5728;<code>set</code>&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x9996;&#x5148;&#x8C03;&#x7528;<code>unobserve</code>&#x5BF9;&#x4E4B;&#x95F4;&#x7684;&#x503C;&#x63A5;&#x89E6;&#x54CD;&#x5E94;&#x5316;&#xFF0C;&#x63A5;&#x7740;&#x8C03;&#x7528;<code>ob.observe</code>&#x4F7F;&#x5F97;&#x65B0;&#x8D4B;&#x503C;&#x7684;&#x6570;&#x636E;&#x54CD;&#x5E94;&#x5316;&#x3002;&#x6700;&#x540E;&#x9996;&#x5148;&#x89E6;&#x53D1;&#x672C;&#x8EAB;&#x7684;<code>set:self</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x63A5;&#x7740;&#x8C03;&#x7528;<code>propagate</code>&#x89E6;&#x53D1;&#x672C;&#x8EAB;&#x4EE5;&#x53CA;&#x7236;&#x7EA7;&#x7684;&#x5BF9;&#x5E94;<code>set</code>&#x4E8B;&#x4EF6;&#x3002;</p><p>&#x3000;&#x3000;<code>$delete</code>&#x7528;&#x4E8E;&#x7ED9;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x8BE5;&#x5C5E;&#x6027;&#x5219;&#x76F4;&#x63A5;&#x9000;&#x51FA;&#xFF0C;&#x5426;&#x5219;&#x5148;&#x7528;<code>delete</code>&#x64CD;&#x4F5C;&#x7B26;&#x5220;&#x9664;&#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x5916;&#x89E6;&#x53D1;&#x672C;&#x8EAB;&#x7684;<code>delete:self</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x63A5;&#x7740;&#x8C03;&#x7528;<code>delete</code>&#x89E6;&#x53D1;&#x672C;&#x8EAB;&#x4EE5;&#x53CA;&#x7236;&#x7EA7;&#x5BF9;&#x5E94;&#x7684;<code>delete</code>&#x4E8B;&#x4EF6;&#x3002;</p><p>&#x3000;&#x3000;&#x770B;&#x5B8C;&#x4E86;<code>objectAgumentations</code>&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5728;<code>Observer</code>&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x77E5;&#x9053;&#xFF0C;&#x5982;&#x679C;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x4E2D;&#x5B58;&#x5728;<code>op.doNotAlterProto</code>&#x610F;&#x5473;&#x7740;&#x4E0D;&#x8981;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#x7684;&#x539F;&#x578B;&#xFF0C;&#x5219;&#x91C7;&#x7528;<code>deepMixin</code>&#x51FD;&#x6570;&#x5C06;<code>$add</code>&#x548C;<code>$delete</code>&#x51FD;&#x6570;&#x6DFB;&#x52A0;&#x5230;&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x5426;&#x5219;&#x91C7;&#x7528;&#x51FD;&#x6570;<code>arguments</code>&#x51FD;&#x6570;&#x5C06;<code>$add</code>&#x548C;<code>$delete</code>&#x6DFB;&#x52A0;&#x5230;&#x5BF9;&#x8C61;&#x7684;&#x539F;&#x578B;&#x4E2D;&#x3002;&#x6700;&#x540E;&#x8C03;&#x7528;&#x4E86;<code>walk</code>&#x51FD;&#x6570;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;<code>walk</code>&#x662F;&#x5185;&#x90E8;&#x662F;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x7684;:<br>&#x3000;&#x3000;</p><div class="widget-codetool" style="display:none"><div class="widget-codetool--inner"><span class="selectCode code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x5168;&#x9009;"></span> <span type="button" class="copyCode code-tool" data-toggle="tooltip" data-placement="top" data-clipboard-text="p.walk = function (obj) {\n  var key, val, descriptor, prefix\n  for (key in obj) {\n    prefix = key.charCodeAt(0)\n    if (\n      prefix === 0x24 || // $\n      prefix === 0x5F    // _\n    ) {\n      continue\n    }\n    descriptor = Object.getOwnPropertyDescriptor(obj, key)\n    // only process own non-accessor properties\n    if (descriptor &amp;&amp; !descriptor.get) {\n      val = obj[key]\n      this.observe(key, val)\n      this.convert(key, val)\n    }\n  }\n}" title="" data-original-title="&#x590D;&#x5236;"></span> <span type="button" class="saveToNote code-tool" data-toggle="tooltip" data-placement="top" title="" data-original-title="&#x653E;&#x8FDB;&#x7B14;&#x8BB0;"></span></div></div><pre class="javascript hljs"><code class="javascript">p.walk = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{\n  <span class="hljs-keyword">var</span> key, val, descriptor, prefix\n  <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> obj) {\n    prefix = key.charCodeAt(<span class="hljs-number">0</span>)\n    <span class="hljs-keyword">if</span> (\n      prefix === <span class="hljs-number">0x24</span> || <span class="hljs-comment">// $</span>\n      prefix === <span class="hljs-number">0x5F</span>    <span class="hljs-comment">// _</span>\n    ) {\n      <span class="hljs-keyword">continue</span>\n    }\n    descriptor = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(obj, key)\n    <span class="hljs-comment">// only process own non-accessor properties</span>\n    <span class="hljs-keyword">if</span> (descriptor &amp;&amp; !descriptor.get) {\n      val = obj[key]\n      <span class="hljs-keyword">this</span>.observe(key, val)\n      <span class="hljs-keyword">this</span>.convert(key, val)\n    }\n  }\n}</code></pre><p>&#x3000;&#x3000;&#x9996;&#x5148;&#x904D;&#x5386;<code>obj</code>&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x4EE5;<code>$</code>&#x6216;&#x8005;<code>_</code>&#x5F00;&#x5934;&#x7684;&#x5C5E;&#x6027;&#x540D;&#xFF0C;&#x5219;&#x4E0D;&#x505A;&#x5904;&#x7406;&#x3002;&#x63A5;&#x7740;&#x83B7;&#x53D6;&#x8BE5;&#x5C5E;&#x6027;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;<code>get</code>&#x51FD;&#x6570;&#xFF0C;&#x5219;&#x5BF9;&#x8BE5;&#x5C5E;&#x6027;&#x503C;&#x8C03;&#x7528;<code>observe</code>&#x51FD;&#x6570;&#xFF0C;&#x4F7F;&#x5F97;&#x6570;&#x636E;&#x54CD;&#x5E94;&#x5316;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;<code>convert</code>&#x51FD;&#x6570;&#x5C06;&#x8BE5;&#x5C5E;&#x6027;&#x8F6C;&#x6362;&#x6210;&#x8BBF;&#x95EE;&#x5668;&#x5C5E;&#x6027;<code>getter/setter</code>&#x4F7F;&#x5F97;&#x5C5E;&#x6027;&#x88AB;&#x8BBF;&#x95EE;&#x6216;&#x8005;&#x88AB;&#x6539;&#x53D8;&#x7684;&#x65F6;&#x5019;&#x80FD;&#x88AB;&#x591F;&#x76D1;&#x542C;&#x3002;<br>&#x3000;&#x3000;</p><h2 id="articleHeader5">&#x603B;&#x7ED3;</h2><p>&#x3000;&#x3000;&#x5230;&#x6B64;&#x4E3A;&#x6B62;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x770B;&#x5B8C;&#x4E86;&#x6574;&#x4E2A;<code>Observer</code>&#x6A21;&#x5757;&#x7684;&#x6240;&#x6709;&#x4EE3;&#x7801;&#xFF0C;&#x5176;&#x5B9E;&#x57FA;&#x672C;&#x539F;&#x7406;&#x548C;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8BBE;&#x60F3;&#x90FD;&#x662F;&#x5DEE;&#x4E0D;&#x591A;&#x7684;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;Vue&#x4EE3;&#x7801;&#x4E2D;&#x5404;&#x4E2A;&#x51FD;&#x6570;&#x5206;&#x89E3;&#x7C92;&#x5EA6;&#x975E;&#x5E38;&#x5C0F;&#xFF0C;&#x4F7F;&#x5F97;&#x4EE3;&#x7801;&#x903B;&#x8F91;&#x975E;&#x5E38;&#x6E05;&#x6670;&#x3002;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x63A8;&#x8350;&#x4F60;&#x4E5F;clone&#x4E00;&#x4EFD;Vue&#x6E90;&#x7801;&#xFF0C;checkout&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x81EA;&#x5DF1;&#x9605;&#x8BFB;&#x4E00;&#x904D;&#xFF0C;&#x8DD1;&#x8DD1;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#xFF0C;&#x6253;&#x4E2A;&#x65AD;&#x70B9;&#x8BD5;&#x7740;&#x8C03;&#x8BD5;&#x4E00;&#x4E0B;&#xFF0C;&#x5E94;&#x8BE5;&#x4F1A;&#x5BF9;&#x4F60;&#x7406;&#x89E3;&#x8FD9;&#x4E2A;&#x6A21;&#x5757;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p><p>&#x3000;&#x3000;&#x6700;&#x540E;&#x5982;&#x679C;&#x5BF9;&#x8FD9;&#x4E2A;&#x7CFB;&#x5217;&#x7684;&#x6587;&#x7AE0;&#x611F;&#x5174;&#x8DA3;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x5173;&#x6CE8;&#x6211;&#x7684;<a href="https://github.com/MrErHu/blog" rel="nofollow noreferrer" target="_blank">Github&#x535A;&#x5BA2;</a>&#x7B97;&#x662F;&#x5BF9;&#x6211;&#x9F13;&#x52B1;&#xFF0C;&#x611F;&#x8C22;&#x5927;&#x5BB6;&#x7684;&#x652F;&#x6301;&#xFF01;<br>&#x3000;&#x3000;<br>&#x3000;&#x3000;<span class="img-wrap"><img data-src="/img/remote/1460000015440155" src="https://static.alili.tech/img/remote/1460000015440155" alt="" title="" style="cursor:pointer;display:inline"></span></p>\n';x=(x=(x=(x=x.replace(/"{/g,"{")).replace(/{"/g,"{")).replace(/"}/g,"}")).replace(/}"/g,"}"),$("#raw").html(x),$("button.preview").hide()})</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Vue响应式数据: Observer模块实现</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000015440152">https://segmentfault.com/a/1190000015440152</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/fgfzcidm9kc/" target="_blank">https://alili.tech/archive/fgfzcidm9kc/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({el:".blog-post-comments",app_id:"ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz",app_key:"hLhtmd4tT0qJbyO2SgQ8odya",placeholder:"说点什么?",avatar:"retro",notify:!0,verify:!0})</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/rg0oddj3fs/">ES6 的解构赋值前每次都创建一个对象吗？会加重 GC 的负担吗？<aside class="dates">2018-11-25</aside></a></li><li><a href="/archive/1gdniq6bvo4/">ES6精华：Promise<aside class="dates">2018-11-25</aside></a></li><li><a href="/archive/rammpgaedbn/">Git Commit Log的小型团队最佳实践<aside class="dates">2018-11-25</aside></a></li><li><a href="/archive/5n9qbxjtync/">Immer.js简析<aside class="dates">2018-11-25</aside></a></li><li><a href="/archive/bfx65io8kzq/">React学习笔记知识点整理<aside class="dates">2018-11-25</aside></a></li><li><a href="/archive/dsljhf8c52n/">Vue项目中添加锁屏功能<aside class="dates">2018-11-25</aside></a></li><li><a href="/archive/q2h23ddajl/">element-ui拆分dialog到子组件<aside class="dates">2018-11-25</aside></a></li><li><a href="/archive/4xu8z5japb7/">前端每日实战：65# 视频演示如何用纯 CSS 创作一个摇摇晃晃的 loader<aside class="dates">2018-11-25</aside></a></li><li><a href="/archive/xn012ye2bug/">基于webpack4搭建的react项目框架<aside class="dates">2018-11-25</aside></a></li><li><a href="/archive/i04wvbwehrd/">快速实现一个简单的canvas迷宫游戏<aside class="dates">2018-11-25</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2018 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>!function(){if("alili.tech"===location.host){var t=document.createElement("script");window.location.protocol.split(":")[0];t.src="https://www.googletagmanager.com/gtag/js?id=UA-129382678-1";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a),window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","UA-129382678-1")}function e(){dataLayer.push(arguments)}}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>