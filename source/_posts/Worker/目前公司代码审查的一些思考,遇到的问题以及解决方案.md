---
title: '目前公司代码审查的一些思考,遇到的问题以及解决方案'
tags:
  - Code Review
abbrlink: 10e9e4de
date: 2018-11-08 00:00:00
---
# 代码审查解决方案
最近在推进公司的代码审查.
经过几天的研究之后,整理出一些问题与解决方案.

## 当前面临的问题

* 没有一个好的工具方便代码审查
* 没有一个好的代码标准代码审查
* 没有一个流程强制执行代码审查
* 没有一个固定职责的人来代码审查
* 代码审查之后的修改跟踪问题
* 代码审查者与代码修复者鼓励机制
* 跨团队资源调配的时候,容易造成过多的代码

## 目标

*  提高代码质量
*  规避潜在问题
*  统一代码风格
*  促进技术交流


# 解决方案

## 基于gitlab二次开发的代码审查平台

### workflow


```flow
st=>start: 需求
op=>operation:  代码变更
op1=>operation: 提交代码
op2=>operation: 发起合并请求
op3=>operation: 代码审查平台拉取最新代码记录
op4=>operation: 评审人员对代码给出建议
op5=>operation: 通知代码提交人
op6=>operation: 更新禅道任务
op7=>operation: 代码优化后,禅道解决标识平台的建议已解决
cond=>condition: 重新评审 通过 or 不通过?
e=>end: 关闭任务


st->op->op1->op2->op3->op4->op5->op6->op7->cond
cond(yes)->e
cond(no)->op
```


### review 技术流程

```flow
st=>start: 创建项目,或者自动创建
op=>operation:  填写git仓库资料
op1=>operation: 同步仓库信息
op2=>operation: 发起合并请求
op3=>operation: 代码审查平台拉取最新代码提交记录
op4=>operation: 评审人员对代码给出建议
op5=>operation: 触发webhook告诉其他系统
op6=>operation: 代码优化后,禅道解决标识平台的建议已解决
cond=>condition: 重新评审 通过 or 不通过?
e=>end: 关闭任务


st->op->op1->op2->op3->op4->op5->op6->cond
cond(yes)->e
cond(no)->op
```

### 审查工具基础功能

* 支持匿名审查
* 关注项目后,查看项目动态
* 每行代码都可以写评论,每条评论可以跟评,做讨论
* 每次合并请求,可以写总体评论
* 审查与修改之后会有相应积分奖励
* 平台与gitlab账号统一,或者支持绑定
* 审查任务自动在禅道上生成任务
* 代码审查优先级分类: 紧急的  一般的 遗留的  
* 代码审查内容分类: 建议 性能 缺陷 规范
* 支持webhook,对接其他系统做好准备
* 邮件提醒


